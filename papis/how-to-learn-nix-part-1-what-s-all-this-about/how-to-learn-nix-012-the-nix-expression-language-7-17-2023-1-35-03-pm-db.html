<!DOCTYPE html> <html lang=en style><!--
 Page saved with SingleFile 
 url: https://ianthehenry.com/posts/how-to-learn-nix/nix-language/ 
 saved date: Mon Jul 17 2023 13:35:03 GMT+0600 (Kyrgyzstan Time)
--><meta charset=utf-8>
<meta name=viewport content="initial-scale=1,maximum-scale=1">
<title>How to Learn Nix, Part 12: The Nix expression language</title>
<link rel=canonical href=https://ianthehenry.com/posts/how-to-learn-nix/nix-language/>
<style>:root{--box-radius:6px;--outer-box-radius:10px}:root{--content-bg:#fff;--gutter-bg:#eeeef3;--text-fg:#4d4d4c;--table-border-color:#ccc;--separator-color:#6d6d6c;--link:#07c;--link-visited:#751a9a;--blockquote-accent:var(--link);--footnote-accent:#ffd2a3;--subscribe-button-bg:#44e66c;--subscribe-button-fg:#11391b;--media-controls-on:#34b553;--media-controls-contrast:#fff;--inline-code-bg:#f3f3fa;--code-block-bg:#f3f3fa;--aside-bg:#f3f3fa;--aside-warning-bg:#fff5d1;--aside-warning-fg:#ac3233;--palette-red:#c82829;--palette-green:#718c00;--palette-yellow:#eab700;--palette-orange:#f5871f;--palette-blue:#4271ae;--palette-purple:#8959a8;--palette-teal:#3e999f;--palette-white:#fefefe;--palette-black:#000;--palette-text:var(--text-fg);--palette-dim:#8e908c;--highlight-bg:var(--palette-yellow);--highlight-fg:var(--text-fg)}#dmt::before{content:"üåñ"}#dmt:hover::before{content:"üåó"}@media (prefers-color-scheme:dark){:root:not(.light-theme){--content-bg:#313233;--gutter-bg:#1d1f21;--text-fg:#d8d4cf;--table-border-color:#ccc;--separator-color:#6d6d6c;--link:rgb(82,183,255);--link-visited:rgb(193,104,229);--blockquote-accent:var(--link);--footnote-accent:#a8612f;--subscribe-button-bg:#44e66c;--subscribe-button-fg:#11391b;--media-controls-on:#44e66c;--media-controls-contrast:#11391b;--inline-code-bg:#3c4044;--code-block-bg:#1d1f21;--aside-bg:#3c4044;--aside-warning-bg:#fff5d1;--aside-warning-fg:var(--palette-red);--palette-red:#cc6666;--palette-green:#b5bd68;--palette-yellow:#f0c674;--palette-orange:#de935f;--palette-blue:#81a2be;--palette-purple:#b294bb;--palette-teal:#8abeb7;--palette-white:#fefefe;--palette-black:#000;--palette-text:var(--text-fg);--palette-dim:#969896;--highlight-bg:var(--palette-yellow);--highlight-fg:var(--palette-black)}:root:not(.light-theme) #dmt::before{content:"üåí"}:root:not(.light-theme) #dmt:hover::before{content:"üåì"}}#dmt{width:30px;text-align:right;padding-right:4px;position:absolute;top:0;bottom:0;right:0;border:none;background-color:inherit;cursor:pointer}*{margin:0;padding:0;font:inherit;box-sizing:border-box}html{background-color:var(--gutter-bg);color:var(--text-fg)}body{font-family:system-ui,sans-serif;font-size:12pt;line-height:1.8;word-wrap:break-word}body:not(.content-page) main>aside{padding:0 var(--content-padding)}body.content-page main,body:not(.content-page) article{background-color:var(--content-bg);border-radius:var(--outer-box-radius);padding:var(--content-padding)}pre{word-wrap:normal}em,i{font-style:italic}sup{font-size:75%}sup a::before{content:"["}sup a::after{content:"]"}h1>a:only-child,h2>a:only-child{display:block}main .subsection-header+.post-list{margin-top:0}strong{font-weight:700}ol,ul{padding-left:3ch}.footnotes>ol{margin-top:1em}.footnotes li:not(.highlight){transition:background-color 1s}hr{border-style:solid;border-width:1.5px 0 0;border-radius:1px;border-color:var(--separator-color)}:not(pre)>code{white-space:pre;background-color:var(--inline-code-bg)}li{padding-left:0}blockquote{quotes:none}blockquote:before,blockquote:after,q:before,q:after{content:"";content:none}a,a:active,a:visited{text-decoration:none}a:hover{text-decoration:underline}blockquote{padding:0 0 0 var(--content-padding);border-left:solid 2px var(--blockquote-accent)}aside{--content-padding:0.5em;padding:.5em;border-radius:var(--box-radius);background-color:var(--aside-bg)}a,a:active,header a:visited,footer a:visited,h1 a:visited{color:var(--link)}a:visited{color:var(--link-visited)}a.footnote-ref:visited,a.footnote-backref:visited,.notation-help-link-container a:visited{color:var(--link)}h1{font-size:130%}main *+p,main *+pre,main *+aside,main *+section,main *+article,main *+blockquote,main *+div,main *+ul,main *+hr,main *+h1{margin-top:1em}main .post-header *+h1{margin-top:0}code{font-family:Menlo,monospace;padding:0 3px;border-radius:2px}pre{background-color:var(--code-block-bg);font-size:11pt;padding:calc(.75*var(--content-padding)) var(--content-padding);line-height:1.3;border-radius:var(--box-radius);overflow-x:scroll;-webkit-overflow-scrolling:touch}pre code{padding:0;border-radius:0;display:inline-block;background-color:initial}p+p{margin-top:1em}body{margin:0 auto;--content-padding:10px;max-width:768px;-webkit-text-size-adjust:100%;position:relative}header{position:relative}header>*{height:48px;line-height:48px}.promo,.promo:visited,.promo:active{display:block;text-align:center;background-color:var(--link);color:var(--code-block-bg);border-radius:0 0 var(--outer-box-radius) var(--outer-box-radius)}header .site-title{font-size:130%}header nav{position:absolute;right:30px;top:0}@media all and (max-width:400px){:root{--outer-box-radius:0}header{text-align:center}header nav{position:static}:not(pre)>code{white-space:pre-wrap}body{--content-padding:10px}#dmt{padding:0;text-align:center;width:40px}}header ul{padding:0}header li{list-style:none;display:inline-block}header a{display:block;height:100%}header li+li{margin-left:1em}footer{padding:2em 0;font-size:.85em;text-align:center}article h1.post-title{font-size:200%}article .post-title a{display:block}article .meta{font-size:90%;font-style:italic}.post-header h1{line-height:1.2em;margin-bottom:.5em}.post-footer{text-align:center}.post-footer a{display:block}ol.post-list{list-style-position:inside;padding:0}.series-rider .series-name{font-style:italic}.highlight{color:var(--palette-text)}.highlight .k{color:var(--palette-purple)}.highlight .n{color:var(--palette-text)}.highlight .o{color:var(--palette-teal)}.highlight .p{color:var(--palette-text)}.highlight .kn{color:var(--palette-teal)}.highlight .no{color:var(--palette-red)}.highlight .mi{color:var(--palette-orange)}.highlight .s2{color:var(--palette-green)}.highlight .si{color:var(--palette-orange)}.highlight .sr{color:var(--palette-green)}</style>
<meta property=og:title content="How to Learn Nix, Part 12: The Nix expression language">
<meta property=og:type content=website>
<meta property=og:url content=https://ianthehenry.com/posts/how-to-learn-nix/nix-language/>
<meta name=description content="Okay! Chapter 15 is finally going to teach us the language we‚Äôve been using for the past several chapters. I‚Äôm excited.

The Nix expression language is a pure, lazy, functional language.

I didn‚Äôt know it was a pure language.">
<meta property=og:description content="Okay! Chapter 15 is finally going to teach us the language we‚Äôve been using for the past several chapters. I‚Äôm excited.

The Nix expression language is a pure, lazy, functional language.

I didn‚Äôt know it was a pure language.">
<meta property=og:image content=https://ianthehenry.com/checkerboard.png>
<meta name=twitter:creator content=@ianthehenry>
<meta name=twitter:card content=summary>
<link type=image/x-icon rel="shortcut icon" href="data:image/vnd.microsoft.icon;base64,AAABAAEAEBAAAAEAIABoBAAAFgAAACgAAAAQAAAAIAAAAAEAIAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAHH1uIDShg/xEsZv8GFk3/CSJb/wgZT/8IGU//CBlP/wkiW/8HGE7/CBlP/wkiW/8HIFX/BxhO/wcgVf8OK2t7JDhz/wcfW/8NNn7/CSpq/wkjYf8MJGP/DCJg/w02ef9SqdX/TKHJ/1my2f9Moc3/UqzV/1Cr1v9Pocf/Ditr/xk2cf8KJGL/CjR8/wwva/8RK2r/Cido/w8qa/8LLW//TqjT/1Gnz/9bsNf/Sp/K/1Wt2f9Wrtj/UKjQ/w8xc/8gPHj/Di5w/xk4ef8TL27/Dy5u/xU3fv8QLGv/Ditr/1qy3f9dttv/Yrje/0ecx/9Knsz/U6fQ/1m13f8YN3n/JjZx/wszdv8YOXz/Eilm/xc3e/8dSZT/GDJz/xk/hv9hu+P/WbHZ/1mv1v9Kn8z/WLHd/1212v9ds9n/Eipr/xcqYv8SOX3/GzRz/xQrZ/8aM3D/HEuU/xc0df8fPYD/Yrre/1603P9dt9z/VKvY/1iz4v9etNr/Y73m/xk5fP8cMm3/JEWK/xc0dP8eO3v/Hjd4/ydRnP8WM3P/Gjd3/2bA5/9dtd//Ybng/2K95v9ct+P/Ybnf/2K95/8oS5L/GChg/xxBh/8lSIz/GC5s/yM5ev8hRoz/HTp7/yE6e/9Zsdz/YLzn/2jF7v9ryfL/YLzn/1qu1f9htdz/GDyD/y0/ev9qx/X/acDn/1235v9euun/Yb3r/1665v9owu7/GUOL/yhGh/8nUJL/MkmI/yBFiP8jOHb/MVag/yM+gv8VMGv/acXx/27G7/9szv3/bMb1/2zD6/9vy/X/edf5/yBHjv8yS47/JEuO/zVLiv8nS5D/LkOB/yRXpP8lQoT/H0WI/3fS+P910Pf/b8/8/2bB7/991Pn/eNb+/3nT+P8pS5L/O1GS/ytUnP86UJH/NF2k/zNLjP8sXKv/JkCB/x4+ff+B2/3/etT9/4He//922f//fNf//3TT//991/7/NU6N/zZSkP86Zav/PlWR/zFepv88ZKb/MF2n/yQ/gf8bNXH/fd3//3/b//+K6P//ft///3vV//993f//gdz//0hWlf9FZKX/RmOj/0JXlv9IeMP/QXKz/0Jsuf8eO3z/Hjt2/3vd//+C3v//ju3//3zg//+H4v//guL//4nj//9HXp3/UGur/ztgqf9JYqP/S3G4/05ur/9EbLT/Hjt7/zNJhf+G4///heT//4rq//+E5///iOT//4jr//+G4///UXO0/09iov9EX6H/SWWn/1V5wP9Kaa7/RGSp/ydLj/8NKGCfDShg/x8+d/8RLGb/CBlP/wYWTf8GFEj/CBNH/wooZP8JIlv/CCJd/woWSf8HGE7/ByBV/wwgU/8fO3mfAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA=="><meta http-equiv=content-security-policy content="default-src 'none'; font-src 'self' data:; img-src 'self' data:; style-src 'unsafe-inline'; media-src 'self' data:; script-src 'unsafe-inline' data:; object-src 'self' data:; frame-src 'self' data:;"><style>img[src="data:,"],source[src="data:,"]{display:none!important}</style></head>
<body class=content-page>
<a class=promo href=https://janet.guide/ target=_blank><i>psst, hey kid, wanna read a weird programming book</i></a>
<header>
<a class=site-title href=https://ianthehenry.com/>Ian Henry</a>
<nav>
<ul><li><a href=https://ianthehenry.com/about/>About</a><li><a href=https://ianthehenry.com/posts/>Blog</a><li><a href=https://ianthehenry.com/stuff/>Stuff</a></ul>
</nav>
<button id=dmt title="Toggle dark mode"></button>
</header>
<main>
<aside class=series-rider>
<p>This post is part of the series <a class=series-name href=https://ianthehenry.com/posts/how-to-learn-nix/>How to Learn Nix</a>, a rambling diary in which I work my way through the Nix manual in excrutiating detail.</p>
</aside>
<article class=post>
<div class=post-header>
<time class=meta datetime=2021-03-10>March 10, 2021</time>
<h1 class=post-title>
<a href=https://ianthehenry.com/posts/how-to-learn-nix/nix-language/>How to Learn Nix, Part&nbsp;12:<br>The Nix expression language</a></h1>
</div>
<div class=post-content><p>Okay! <a href=https://web.archive.org/web/20210227145624/https://nixos.org/manual/nix/stable/#ch-expression-language>Chapter 15</a> is finally going to teach us the language we‚Äôve been using for the past several chapters. I‚Äôm excited.</p>
<blockquote>
<p>The Nix expression language is a pure, lazy, functional language.</p>
</blockquote>
<p>I didn‚Äôt know it was a pure language.</p>
<p>It would be really <em>weird</em> to have a general purpose language with non-strict evaluation that does not explicitly separate side effects from pure code. But this is just a language for describing packages ‚Äì I could imagine relying on the fact that we don‚Äôt evaluate packages until we need to as a way to, like, delay the side effect of installing them (or whatever) until it‚Äôs necessary. This was, briefly, how I guessed that <code>fetchurl</code> worked.</p>
<blockquote>
<p>Its main job is to describe packages, compositions of packages, and the variability within packages.</p>
</blockquote>
<p>I once again wonder what ‚Äúcompositions of packages‚Äù means. And ‚Äúthe variability within packages.‚Äù That‚Äôs a very poetic sentiment, isn‚Äôt it? I enjoy the sound of it; I spend a moment meditating on the fickle nature of packages. But I don‚Äôt know‚Ä¶ what it means.</p>
<h1 id=151-valueshttpswebarchiveorgweb20210227145624httpsnixosorgmanualnixstablessec-values><a href=https://web.archive.org/web/20210227145624/https://nixos.org/manual/nix/stable/#ssec-values>15.1. Values</a></h1>
<p>We finally see some types! Yes. I am excited.</p>
<p>Here‚Äôs what we‚Äôre working with:</p>
<ul>
<li>strings</li>
<li>numbers</li>
<li>paths</li>
<li>booleans</li>
<li>null</li>
</ul>
<p>Null? Nix appears to be dynamically typed, so I‚Äôll allow it. But consider this your first warning.</p>
<p>There‚Äôs like three pages of words about strings here. Normal escape characters. Interpolation (Nix calls it ‚Äúantiquotation‚Äù) with <code>${...}</code>, ala shell.</p>
<p>I learn that strings, paths, and derivations can all be ‚Äúcoerced into a string‚Äù in an interpolation. Wait, derivations? That wasn‚Äôt a type. Or it wasn‚Äôt a ‚Äúbasic type?‚Äù Hmm. Did the manual just give us a non-exhaustive list of types? Yes. It did.</p>
<p>I‚Äôm just gonna leave this one right here:</p>
<blockquote>
<p>Since <code>${</code> and <code>''</code> have special meaning in indented strings, you need a way to quote them. <code>$</code> can be escaped by prefixing it with <code>''</code> (that is, two single quotes), i.e., <code>''$</code>. <code>''</code> can be escaped by prefixing it with <code>'</code>, i.e., <code>'''</code>. <code>$</code> removes any special meaning from the following <code>$</code>.</p>
</blockquote>
<p>Any questions?</p>
<p>I learn that URIs can be written as unquoted strings, for some reason. But unlike paths, which actually are their own type, this is just a different string literal syntax. Weird.</p>
<p>Next up: numbers are numbers. Ints and floats. Nothing about the precision of them.</p>
<p>And then paths. Relative file paths are ‚Äúmade absolute at parse time.‚Äù Okay? That seems‚Ä¶ weird. So if I write:</p>
<div class=highlight><pre tabindex=0 class=chroma><code class=language-nix data-lang=nix><span class=n>mkDerivation</span> <span class=p>{</span>
    <span class=n>builder</span> <span class=o>=</span> <span class=sr>./builder.sh</span><span class=p>;</span>
<span class=p>}</span>
</code></pre></div><p>Then <code>builder</code> is going to be <code>/Users/ian/src/nixpkgs/pkgs/whatever/my-thing/builder.sh</code>? I mean I guess I just need to make sure that paths never leak out into my output or something. Yeah, okay, this makes sense.</p>
<p>Aha:</p>
<blockquote>
<p>Paths can also be specified between angle brackets, e.g. <code>&lt;nixpkgs&gt;</code>. This means that the directories listed in the environment variable <code>NIX_PATH</code> will be searched for the given file or directory name.</p>
</blockquote>
<p>Okay. Good; I‚Äôve been wondering about <code>&lt;nixpkgs&gt;</code>.</p>
<pre><code>$ echo $NIX_PATH
/Users/ian/.nix-defexpr/channels
</code></pre>
<p>Gotcha. So <code>&lt;nixpkgs&gt;</code> is short for <code>/Users/ian/.nix-defexpr/channels/nixpkgs</code> (at the moment). Neat.</p>
<p>Not much to say about bools or nulls.</p>
<p>Then lists‚Ä¶ our first type that is not a ‚Äúbasic type.‚Äù Lists are lazy in values, strict in length. Alright. I mentally picture a linked list of thunks, not a cons cell pointing to a thunk.<sup id=fnref:1><a href=#fn:1 class=footnote-ref role=doc-noteref>1</a></sup> List elements are just separated by whitespace, not commas. That‚Äôs‚Ä¶ weird to me. But sure, okay. More parens are never a bad thing in my book.</p>
<p>And finally we come to sets.</p>
<p>I don‚Äôt like the word ‚Äúset.‚Äù Does anyone like the word ‚Äúset,‚Äù for this concept? Is anyone okay with this?</p>
<p>I will try to think of the term as shorthand for ‚Äúsets of bindings,‚Äù because that seems to be what they are.</p>
<blockquote>
<p>Sets are really the core of the language, since ultimately the Nix language is all about creating derivations, which are really just sets of attributes to be passed to build scripts.</p>
</blockquote>
<p>Hmm. Is that really what a derivation is? I feel like a hunter, gently circling the definition of ‚Äúderivation,‚Äù trying not to startle it. One day I will have it in my sights.</p>
<p>We‚Äôve seen plenty of sets by now, so most of the examples are not interesting.</p>
<p>I learn the <code>or</code> syntax, which is weird:</p>
<blockquote>
<div class=highlight><pre tabindex=0 class=chroma><code class=language-nix data-lang=nix><span class=p>{</span> <span class=n>a</span> <span class=o>=</span> <span class=s2>"Foo"</span><span class=p>;</span> <span class=n>b</span> <span class=o>=</span> <span class=s2>"Bar"</span><span class=p>;</span> <span class=p>}</span><span class=o>.</span><span class=n>c</span> <span class=n>or</span> <span class=s2>"Xyzzy"</span>
</code></pre></div></blockquote>
<p>The documentation implies this is a language construct, not a null coalescing operator or something ‚Äì <code>or</code> must be attached to an attribute access.</p>
<p>I learn that attribute names can be arbitrary strings, and can be quoted, both in a declaration or a lookup. Even dynamically determined:</p>
<blockquote>
<div class=highlight><pre tabindex=0 class=chroma><code class=language-nix data-lang=nix><span class=p>{</span> <span class=s2>"foo </span><span class=si>${</span><span class=n>bar</span><span class=si>}</span><span class=s2>"</span> <span class=o>=</span> <span class=mi>123</span><span class=p>;</span> <span class=s2>"nix-1.0"</span> <span class=o>=</span> <span class=mi>456</span><span class=p>;</span> <span class=p>}</span><span class=o>.</span><span class=s2>"foo </span><span class=si>${</span><span class=n>bar</span><span class=si>}</span><span class=s2>"</span>
</code></pre></div></blockquote>
<p>I learn the equivalent of JavaScript‚Äôs <code>foo[bar]</code> syntax is <code>foo.${bar}</code>: you can omit the quotes in this simple case.</p>
<blockquote>
<p>In the special case where an attribute name inside of a set declaration evaluates to <code>null</code> (which is normally an error, as <code>null</code> is not antiquotable), that attribute is simply not added to the set.</p>
</blockquote>
<p>Neat.</p>
<p>And then we take a <em>sharp turn</em>:</p>
<blockquote>
<p>A set that has a <code>__functor</code> attribute whose value is callable (i.e. is itself a function or a set with a <code>__functor</code> attribute whose value is callable) can be applied as if it were a function, with the set itself passed in first , e.g.,</p>
<div class=highlight><pre tabindex=0 class=chroma><code class=language-nix data-lang=nix><span class=k>let</span> <span class=n>add</span> <span class=o>=</span> <span class=p>{</span> <span class=n>__functor</span> <span class=o>=</span> <span class=n>self</span><span class=p>:</span> <span class=n>x</span><span class=p>:</span> <span class=n>x</span> <span class=o>+</span> <span class=n>self</span><span class=o>.</span><span class=n>x</span><span class=p>;</span> <span class=p>};</span>
  <span class=n>inc</span> <span class=o>=</span> <span class=n>add</span> <span class=o>//</span> <span class=p>{</span> <span class=n>x</span> <span class=o>=</span> <span class=mi>1</span><span class=p>;</span> <span class=p>};</span>
<span class=k>in</span> <span class=n>inc</span> <span class=mi>1</span>
</code></pre></div></blockquote>
<p>Okaaaay. Don‚Äôt know what <code>//</code> is, but this makes sense. We have ‚Äúcallable‚Äù sets.</p>
<p>Wait, what <em>is</em> <code>//</code>? Partial application, by name, to a <em>curried function?</em> No; that‚Äôd be insane. <code>x</code> means two things here. I guess it‚Äôs ‚Äúset union‚Äù? So <code>inc</code> ends up looking like:</p>
<div class=highlight><pre tabindex=0 class=chroma><code class=language-nix data-lang=nix><span class=p>{</span>
  <span class=n>__functor</span> <span class=o>=</span> <span class=n>self</span><span class=p>:</span> <span class=n>x</span><span class=p>:</span> <span class=n>x</span> <span class=o>+</span> <span class=n>self</span><span class=o>.</span><span class=n>x</span><span class=p>;</span>
  <span class=n>x</span> <span class=o>=</span> <span class=mi>1</span><span class=p>;</span>
<span class=p>}</span>
</code></pre></div><p>Sure. Okay. That makes sense. Crystal clear example.</p>
<blockquote>
<p>This can be used to attach metadata to a function without the caller needing to treat it specially, or to implement a form of object-oriented programming, for example.</p>
</blockquote>
<p><em>You take that back</em>. I thought this was a safe space.</p>
<h1 id=152-language-constructshttpswebarchiveorgweb20210227145624httpsnixosorgmanualnixstablesec-constructs><a href=https://web.archive.org/web/20210227145624/https://nixos.org/manual/nix/stable/#sec-constructs>15.2. Language Constructs</a></h1>
<p>Recursive sets, which we‚Äôve seen.</p>
<p><code>let</code> expressions, which probably look super weird to most people but which I am familiar with from Haskell and OCaml. If I were writing the manual I would call out the difference between ‚Äúvariables‚Äù and ‚Äúbindings‚Äù here and explain how sequences of statements don‚Äôt make sense in a purely expression-oriented world and thus we need to scope bindings over another expression using <code>in</code> instead of just ‚Äúsetting a variable.‚Äù</p>
<p>But I am not writing the manual. Good thing, probably.</p>
<p>I learn that in addition to <code>inherit</code> I can inherit from another set.</p>
<p>Once upon a time someone paid me to write something called ‚ÄúCoffeeScript,‚Äù which uses this syntax for declaring objects:</p>
<pre><code>{ foo: bar, baz }
</code></pre>
<p>That‚Äôs short for:</p>
<pre><code>{ foo: bar, baz: baz }
</code></pre>
<p>And I wished, on more than one occasion, that I could also write this:</p>
<pre><code>{ foo: bar, something.baz }
</code></pre>
<p>As shorthand for:</p>
<pre><code>{ foo: bar, baz = something.baz }
</code></pre>
<p>But I could not. At least not at the time. This was years and years ago. Maybe they added that? I assume CoffeeScript does not exist anymore, now that ES6 is widely available. To retain my innocence, I do not google it.</p>
<p>But in Nix, it seems, I can finally live the dream:</p>
<div class=highlight><pre tabindex=0 class=chroma><code class=language-nix data-lang=nix><span class=p>{</span> <span class=n>foo</span> <span class=o>=</span> <span class=n>bar</span><span class=p>;</span> <span class=k>inherit</span> <span class=p>(</span><span class=n>something</span><span class=p>)</span> <span class=n>baz</span><span class=p>;</span> <span class=p>}</span>
</code></pre></div><p>Ummm. Yes. Very‚Ä¶ elegant. I think I‚Äôm good.</p>
<p>Functions. Function parameters are patterns, which I am familiar with, but it seems that I cannot use lists as a pattern ‚Äì only sets. I‚Äôm fine with that. I learn that I can use <code>...</code> to ignore extra attributes in a set:</p>
<div class=highlight><pre tabindex=0 class=chroma><code class=language-nix data-lang=nix><span class=p>{</span> <span class=n>a</span><span class=o>,</span> <span class=n>b</span><span class=o>,</span> <span class=n>c</span><span class=o>,</span> <span class=o>...</span> <span class=p>}</span>
</code></pre></div><p>Optional attributes in set arguments. Alias patterns. Caveat that the alias patterns do <em>not</em> include the defaulted values. I‚Äôm very glad they call this out because I could see that going either way. Thank you, Nix manual author.</p>
<p>Conditional expressions: <code>if foo then bar else baz</code>. It‚Äôs sort of interesting to think about the fact that lazily evaluated languages don‚Äôt <em>need</em> an explicit built-in language feature for branching ‚Äì you can get away with a built-in function <code>if(foo, bar, baz)</code>, and only one expression will actually end up being evaluated. But I find the <code>if-then-else</code> syntax much easier to read.</p>
<p>Assertion expressions!</p>
<div class=highlight><pre tabindex=0 class=chroma><code class=language-nix data-lang=nix><span class=k>assert</span> <span class=n>e1</span><span class=p>;</span> <span class=n>e2</span>
</code></pre></div><p>This is another thing that might look weird coming from languages with statements ‚Äì this is still an expression, even though it <em>looks</em> like that semicolon is acting as a statement terminator. Don‚Äôt be fooled.</p>
<h1 id=example-151-nix-expression-for-subversionhttpswebarchiveorgweb20210227145624httpsnixosorgmanualnixstableex-subversion-nix><a href=https://web.archive.org/web/20210227145624/https://nixos.org/manual/nix/stable/#ex-subversion-nix>Example 15.1. Nix expression for Subversion</a></h1>
<p>The manual walks through an example of a ‚Äúreal‚Äù package:</p>
<blockquote>
<div class=highlight><pre tabindex=0 class=chroma><code class=language-nix data-lang=nix><span class=p>{</span> <span class=n>localServer</span> <span class=o>?</span> <span class=no>false</span>
<span class=o>,</span> <span class=n>httpServer</span> <span class=o>?</span> <span class=no>false</span>
<span class=o>,</span> <span class=n>sslSupport</span> <span class=o>?</span> <span class=no>false</span>
<span class=o>,</span> <span class=n>pythonBindings</span> <span class=o>?</span> <span class=no>false</span>
<span class=o>,</span> <span class=n>javaSwigBindings</span> <span class=o>?</span> <span class=no>false</span>
<span class=o>,</span> <span class=n>javahlBindings</span> <span class=o>?</span> <span class=no>false</span>
<span class=o>,</span> <span class=n>stdenv</span><span class=o>,</span> <span class=n>fetchurl</span>
<span class=o>,</span> <span class=n>openssl</span> <span class=o>?</span> <span class=no>null</span><span class=o>,</span> <span class=n>httpd</span> <span class=o>?</span> <span class=no>null</span><span class=o>,</span> <span class=n>db4</span> <span class=o>?</span> <span class=no>null</span><span class=o>,</span> <span class=n>expat</span><span class=o>,</span> <span class=n>swig</span> <span class=o>?</span> <span class=no>null</span><span class=o>,</span> <span class=n>j2sdk</span> <span class=o>?</span> <span class=no>null</span>
<span class=p>}:</span>

<span class=k>assert</span> <span class=n>localServer</span> <span class=o>-&gt;</span> <span class=n>db4</span> <span class=o>!=</span> <span class=no>null</span><span class=p>;</span>
<span class=k>assert</span> <span class=n>httpServer</span> <span class=o>-&gt;</span> <span class=n>httpd</span> <span class=o>!=</span> <span class=no>null</span> <span class=o>&amp;&amp;</span> <span class=n>httpd</span><span class=o>.</span><span class=n>expat</span> <span class=o>==</span> <span class=n>expat</span><span class=p>;</span>
<span class=k>assert</span> <span class=n>sslSupport</span> <span class=o>-&gt;</span> <span class=n>openssl</span> <span class=o>!=</span> <span class=no>null</span> <span class=o>&amp;&amp;</span> <span class=p>(</span><span class=n>httpServer</span> <span class=o>-&gt;</span> <span class=n>httpd</span><span class=o>.</span><span class=n>openssl</span> <span class=o>==</span> <span class=n>openssl</span><span class=p>);</span>
<span class=k>assert</span> <span class=n>pythonBindings</span> <span class=o>-&gt;</span> <span class=n>swig</span> <span class=o>!=</span> <span class=no>null</span> <span class=o>&amp;&amp;</span> <span class=n>swig</span><span class=o>.</span><span class=n>pythonSupport</span><span class=p>;</span>
<span class=k>assert</span> <span class=n>javaSwigBindings</span> <span class=o>-&gt;</span> <span class=n>swig</span> <span class=o>!=</span> <span class=no>null</span> <span class=o>&amp;&amp;</span> <span class=n>swig</span><span class=o>.</span><span class=n>javaSupport</span><span class=p>;</span>
<span class=k>assert</span> <span class=n>javahlBindings</span> <span class=o>-&gt;</span> <span class=n>j2sdk</span> <span class=o>!=</span> <span class=no>null</span><span class=p>;</span>

<span class=n>stdenv</span><span class=o>.</span><span class=n>mkDerivation</span> <span class=p>{</span>
  <span class=n>name</span> <span class=o>=</span> <span class=s2>"subversion-1.1.1"</span><span class=p>;</span>
  <span class=o>...</span>
  <span class=n>openssl</span> <span class=o>=</span> <span class=k>if</span> <span class=n>sslSupport</span> <span class=k>then</span> <span class=n>openssl</span> <span class=k>else</span> <span class=no>null</span><span class=p>;</span>
  <span class=o>...</span>
<span class=p>}</span>
</code></pre></div></blockquote>
<p>It‚Äôs very straightforward, having already seen the <code>hello</code> example, so I won‚Äôt really say many words about it. Except to highlight this line:</p>
<div class=highlight><pre tabindex=0 class=chroma><code class=language-nix data-lang=nix><span class=k>assert</span> <span class=n>sslSupport</span> <span class=o>-&gt;</span> <span class=n>openssl</span> <span class=o>!=</span> <span class=no>null</span> <span class=o>&amp;&amp;</span> <span class=p>(</span><span class=n>httpServer</span> <span class=o>-&gt;</span> <span class=n>httpd</span><span class=o>.</span><span class=n>openssl</span> <span class=o>==</span> <span class=n>openssl</span><span class=p>);</span>
</code></pre></div><p>I <em>assume</em> that this is an <em>implication operator</em>, even though I don‚Äôt think I have ever seen a language with an implication operator before. That‚Äôs very nifty: people <em>think</em> in terms of implication all the time, but usually have to write the gross expansion using negation and disjunction. Yeah, that‚Äôs right. I know some words.</p>
<p>Moving past the example, I learn about <code>with</code> expressions ‚Äì basically an equivalent of <code>open</code> or <code>use</code> or whatever. Do you remember when JavaScript had <code>with</code>? Man, what a crazy time to be alive. I assume it‚Äôs still in there, technically, because getting rid of it would break‚Ä¶ I don‚Äôt know. Something that deserves to be broken. Anyway, it probably makes sense in Nix.</p>
<p>Shoutout to some documentation I love:</p>
<blockquote>
<p>The most common use of <code>with</code> is in conjunction with the <code>import</code> function. E.g.,</p>
<div class=highlight><pre tabindex=0 class=chroma><code class=language-nix data-lang=nix><span class=k>with</span> <span class=p>(</span><span class=kn>import</span> <span class=sr>./definitions.nix</span><span class=p>);</span> <span class=o>...</span>
</code></pre></div></blockquote>
<p><em>Thank you</em>. I love that. Show me a thing, tell me how it works in a vacuum, then tell me how it‚Äôs typically used. Make it concrete.</p>
<p>This is very unexpected to me:</p>
<blockquote>
<p>The bindings introduced by <code>with</code> do not shadow bindings introduced by other means.</p>
</blockquote>
<p>So basically <code>let x = 1 in with { x = 2 }; x</code> evaluates to <code>1</code>. I understand <em>why</em> Nix wants to do this ‚Äì preventing action at a distance significantly changing the meaning of your code ‚Äì but it‚Äôs <em>weird</em>. It doesn‚Äôt feel <em>principled</em> ‚Äì it breaks my mental model of ‚Äúlinked list of scopes searched upwards‚Äù that I am used to from every other language with lexical scope. It‚Äôs like <em>two</em> linked lists now, I guess, and we search the ‚Äúprimary‚Äù list of scopes ‚Äì <code>let</code> bindings and function names and whatever ‚Äì before we look in the ‚Äúfallback‚Äù scopes, which are extended by <code>with</code>? I mean, <em>okay</em>. Weird, but pragmatic.</p>
<p>Hybrid comment style: we have <code>#</code> and <code>/* ... */</code>. I like that, personally, but it‚Äôs a little weird.</p>
<h1 id=153-operatorshttpswebarchiveorgweb20210227145624httpsnixosorgmanualnixstablesec-language-operators><a href=https://web.archive.org/web/20210227145624/https://nixos.org/manual/nix/stable/#sec-language-operators>15.3. Operators</a></h1>
<p>This is a big long table of stuff; I won‚Äôt repeat it all here. Mostly stuff you‚Äôd expect. Some new stuff:</p>
<p><code>set ? attr</code> is like JavaScript‚Äôs <code>of</code> operator; it checks if an attribute is defined on a given set. <code>++</code> concatenates lists, like Haskell ‚Äì apparently there‚Äôs no operator overloading, so we can‚Äôt use <code>+</code>? Except that, no, <code>+</code> <em>is</em> used to concatenate strings. So that‚Äôs weird.</p>
<p>I called <code>//</code> ‚Äúset union;‚Äù they call it ‚Äúset update‚Äù ‚Äì I had the same semantics in mind, but of course these aren‚Äôt <em>sets</em> they‚Äôre actually <em>maps</em> so we need to do something on key collision ‚Äì and it picks the righthand values, as you‚Äôd expect.</p>
<p>No other operators over maps‚Äì excuse me, ‚Äúsets.‚Äù</p>
<p>That‚Äôs the end of this section, although the chapter is still going. But the next section is called ‚ÄúDerivations,‚Äù and I assume that it will deserve to get its own blog post, so I‚Äôll end this one here.</p>
<hr>
<ul>
<li>What is the ‚Äútype‚Äù of a derivation?</li>
<li>What are the sizes of integral and floating point numbers?</li>
</ul>
<section class=footnotes role=doc-endnotes>
<hr>
<ol>
<li id=fn:1 role=doc-endnote>
<p>I picture thunks as little cartoon thought bubbles and now maybe you do too.&nbsp;<a href=#fnref:1 class=footnote-backref role=doc-backlink>‚Ü©Ô∏é</a></p>
</li>
</ol>
</section></div>
</article>
<div class=post-footer>
<a href="mailto:ianthehenry@gmail.com?subject=let%27s%20talk%20about%20%22The%20Nix%20expression%20language%22&amp;body=First%20of%20all,%20I%20just%20wanted%20to%20say%20that%20I%20forgive%20you%20for%20not%20having%20a%20real%20comment%20system%20on%20your%20site.">comment on this post</a><a href=https://ianthehenry.com/posts/how-to-learn-nix/derivations/>Next up ‚ûú Derivations</a></div>
<aside class=series-rider>
<p>
This post is part of the series <a class=series-name href=https://ianthehenry.com/posts/how-to-learn-nix/>How to Learn Nix</a>.
You can
<a target=_blank href=https://ianthehenry.com/feed.xml>subscribe to my RSS feed</a>
or
<a target=_blank href=https://twitter.com/ianthehenry>follow me on Twitter</a>
for more, or <a href=https://ianthehenry.com/posts/>peruse my back catalog</a> if you're in the mood for something different.
<div class=subsection-header>Opening remarks</div><ol start=1 class=post-list><li><a href=https://ianthehenry.com/posts/how-to-learn-nix/introduction/>What's all this about?</a></li>
<li><a href=https://ianthehenry.com/posts/how-to-learn-nix/prior-knowledge/>Prior knowledge</a></li>
</ol><div class=subsection-header>Reading the Nix manual</div><ol start=3 class=post-list><li><a href=https://ianthehenry.com/posts/how-to-learn-nix/glossary/>What we talk about when we talk about Nix</a></li>
<li><a href=https://ianthehenry.com/posts/how-to-learn-nix/quick-start-guide/>Quick starts, full hearts</a></li>
<li><a href=https://ianthehenry.com/posts/how-to-learn-nix/basic-package-management/>Basic package management</a></li>
<li><a href=https://ianthehenry.com/posts/how-to-learn-nix/profiles/>Profiles</a></li>
<li><a href=https://ianthehenry.com/posts/how-to-learn-nix/garbage-collection/>Garbage collection</a></li>
<li><a href=https://ianthehenry.com/posts/how-to-learn-nix/channels/>Channels</a></li>
<li><a href=https://ianthehenry.com/posts/how-to-learn-nix/sharing/>Learning to share</a></li>
<li><a href=https://ianthehenry.com/posts/how-to-learn-nix/my-first-derivation/>My first derivation</a></li>
<li><a href=https://ianthehenry.com/posts/how-to-learn-nix/okay-my-actual-first-derivation/>Okay my actual first derivation</a></li>
<li><strong><a href=https://ianthehenry.com/posts/how-to-learn-nix/nix-language/>The Nix expression language</a></strong>&nbsp;‚Üê&nbsp;you are here</li>
<li><a href=https://ianthehenry.com/posts/how-to-learn-nix/derivations/>Derivations</a></li>
<li><a href=https://ianthehenry.com/posts/how-to-learn-nix/built-in-functions/>Built-in Functions</a></li>
<li><a href=https://ianthehenry.com/posts/how-to-learn-nix/advanced-topics/>Advanced Topics</a></li>
<li><a href=https://ianthehenry.com/posts/how-to-learn-nix/command-reference/>Command Reference</a></li>
<li><a href=https://ianthehenry.com/posts/how-to-learn-nix/configuration/>Configuration</a></li>
</ol><div class=subsection-header>Interlude: in which we follow our hearts, however briefly</div><ol start=18 class=post-list><li><a href=https://ianthehenry.com/posts/how-to-learn-nix/nix-manual-reflection/>So I read the manual huh</a></li>
<li><a href=https://ianthehenry.com/posts/how-to-learn-nix/switching-from-homebrew-to-nix/>Switching from Homebrew to Nix</a></li>
<li><a href=https://ianthehenry.com/posts/how-to-learn-nix/my-first-nix-bug/>My first Nix bug</a></li>
<li><a href=https://ianthehenry.com/posts/how-to-learn-nix/my-first-package-upgrade/>My first package upgrade</a></li>
<li><a href=https://ianthehenry.com/posts/how-to-learn-nix/declarative-user-environment/>Setting up a declarative user environment</a></li>
</ol><div class=subsection-header>Reading the Nixpkgs manual</div><ol start=23 class=post-list><li><a href=https://ianthehenry.com/posts/how-to-learn-nix/how-to-learn-nixpkgs/>How to learn Nixpkgs</a></li>
<li><a href=https://ianthehenry.com/posts/how-to-learn-nix/overlays/>Overlays</a></li>
<li><a href=https://ianthehenry.com/posts/how-to-learn-nix/overriding/>Overriding</a></li>
<li><a href=https://ianthehenry.com/posts/how-to-learn-nix/an-infinite-list-of-functions/>An infinite list of functions</a></li>
<li><a href=https://ianthehenry.com/posts/how-to-learn-nix/even-more-functions-somehow/>Even more functions, somehow</a></li>
<li><a href=https://ianthehenry.com/posts/how-to-learn-nix/the-standard-environment/>The standard environment</a></li>
<li><a href=https://ianthehenry.com/posts/how-to-learn-nix/derivations-in-detail/>Derivations in detail</a></li>
<li><a href=https://ianthehenry.com/posts/how-to-learn-nix/cross-compilation/>Cross-compilation</a></li>
<li><a href=https://ianthehenry.com/posts/how-to-learn-nix/platform-notes/>Platform notes</a></li>
<li><a href=https://ianthehenry.com/posts/how-to-learn-nix/builders/>Builders</a></li>
<li><a href=https://ianthehenry.com/posts/how-to-learn-nix/languages-and-frameworks/>Languages and frameworks</a></li>
<li><a href=https://ianthehenry.com/posts/how-to-learn-nix/random-package-grab-bag/>Random package grab-bag</a></li>
<li><a href=https://ianthehenry.com/posts/how-to-learn-nix/how-to-give-back/>How to give back</a></li>
</ol><div class=subsection-header>Documentation behind us, we set out on our own</div><ol start=36 class=post-list><li><a href=https://ianthehenry.com/posts/how-to-learn-nix/nixpkgs-reflection/>So I read the other manual, huh</a></li>
<li><a href=https://ianthehenry.com/posts/how-to-learn-nix/saving-your-shell/>Saving your shell</a></li>
</ol><div class=subsection-header>Oh right forgot about Nix Pills</div><ol start=38 class=post-list><li><a href=https://ianthehenry.com/posts/how-to-learn-nix/nix-pills/>Nix Pills</a></li>
</ol><div class=subsection-header>Our whole lives ahead of us</div><ol start=39 class=post-list><li><a href=https://ianthehenry.com/posts/how-to-learn-nix/python3-alpha/>How to install Python</a></li>
<li><a href=https://ianthehenry.com/posts/how-to-learn-nix/open-questions/>Open questions</a></li>
<li><a href=https://ianthehenry.com/posts/how-to-learn-nix/ambiguous-packages/>Ambiguous packages</a></li>
<li><a href=https://ianthehenry.com/posts/how-to-learn-nix/nix-zshell/>Running zsh in nix-shell</a></li>
</ol><div class=subsection-header>Nix 2.4 slithers to life</div><ol start=43 class=post-list><li><a href=https://ianthehenry.com/posts/how-to-learn-nix/flakes/>My first brush with flakes</a></li>
<li><a href=https://ianthehenry.com/posts/how-to-learn-nix/more-flakes/>More flakes, unfortunately</a></li>
<li><a href=https://ianthehenry.com/posts/how-to-learn-nix/new-profiles/>Fancy new profiles</a></li>
<li><a href=https://ianthehenry.com/posts/how-to-learn-nix/chipping-away-at-flakes/>Chipping away at flakes</a></li>
<li><a href=https://ianthehenry.com/posts/how-to-learn-nix/nix-develop/>New and unimproved shells</a></li>
</ol>
</aside>
</main>
<footer>
¬© 1899-1907 <a href=https://ianthehenry.com/about/>Ian Henry</a>
</footer>
