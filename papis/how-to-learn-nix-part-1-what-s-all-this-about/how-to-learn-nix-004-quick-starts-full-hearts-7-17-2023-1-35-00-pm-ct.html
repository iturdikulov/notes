<!DOCTYPE html> <html lang=en style><!--
 Page saved with SingleFile 
 url: https://ianthehenry.com/posts/how-to-learn-nix/quick-start-guide/ 
 saved date: Mon Jul 17 2023 13:35:00 GMT+0600 (Kyrgyzstan Time)
--><meta charset=utf-8>
<meta name=viewport content="initial-scale=1,maximum-scale=1">
<title>How to Learn Nix, Part 4: Quick starts, full hearts</title>
<link rel=canonical href=https://ianthehenry.com/posts/how-to-learn-nix/quick-start-guide/>
<style>:root{--box-radius:6px;--outer-box-radius:10px}:root{--content-bg:#fff;--gutter-bg:#eeeef3;--text-fg:#4d4d4c;--table-border-color:#ccc;--separator-color:#6d6d6c;--link:#07c;--link-visited:#751a9a;--blockquote-accent:var(--link);--footnote-accent:#ffd2a3;--subscribe-button-bg:#44e66c;--subscribe-button-fg:#11391b;--media-controls-on:#34b553;--media-controls-contrast:#fff;--inline-code-bg:#f3f3fa;--code-block-bg:#f3f3fa;--aside-bg:#f3f3fa;--aside-warning-bg:#fff5d1;--aside-warning-fg:#ac3233;--palette-red:#c82829;--palette-green:#718c00;--palette-yellow:#eab700;--palette-orange:#f5871f;--palette-blue:#4271ae;--palette-purple:#8959a8;--palette-teal:#3e999f;--palette-white:#fefefe;--palette-black:#000;--palette-text:var(--text-fg);--palette-dim:#8e908c;--highlight-bg:var(--palette-yellow);--highlight-fg:var(--text-fg)}#dmt::before{content:"üåñ"}#dmt:hover::before{content:"üåó"}@media (prefers-color-scheme:dark){:root:not(.light-theme){--content-bg:#313233;--gutter-bg:#1d1f21;--text-fg:#d8d4cf;--table-border-color:#ccc;--separator-color:#6d6d6c;--link:rgb(82,183,255);--link-visited:rgb(193,104,229);--blockquote-accent:var(--link);--footnote-accent:#a8612f;--subscribe-button-bg:#44e66c;--subscribe-button-fg:#11391b;--media-controls-on:#44e66c;--media-controls-contrast:#11391b;--inline-code-bg:#3c4044;--code-block-bg:#1d1f21;--aside-bg:#3c4044;--aside-warning-bg:#fff5d1;--aside-warning-fg:var(--palette-red);--palette-red:#cc6666;--palette-green:#b5bd68;--palette-yellow:#f0c674;--palette-orange:#de935f;--palette-blue:#81a2be;--palette-purple:#b294bb;--palette-teal:#8abeb7;--palette-white:#fefefe;--palette-black:#000;--palette-text:var(--text-fg);--palette-dim:#969896;--highlight-bg:var(--palette-yellow);--highlight-fg:var(--palette-black)}:root:not(.light-theme) #dmt::before{content:"üåí"}:root:not(.light-theme) #dmt:hover::before{content:"üåì"}}#dmt{width:30px;text-align:right;padding-right:4px;position:absolute;top:0;bottom:0;right:0;border:none;background-color:inherit;cursor:pointer}*{margin:0;padding:0;font:inherit;box-sizing:border-box}html{background-color:var(--gutter-bg);color:var(--text-fg)}body{font-family:system-ui,sans-serif;font-size:12pt;line-height:1.8;word-wrap:break-word}body:not(.content-page) main>aside{padding:0 var(--content-padding)}body.content-page main,body:not(.content-page) article{background-color:var(--content-bg);border-radius:var(--outer-box-radius);padding:var(--content-padding)}pre{word-wrap:normal}em,i{font-style:italic}sup{font-size:75%}sup a::before{content:"["}sup a::after{content:"]"}h1>a:only-child,h2>a:only-child{display:block}main .subsection-header+.post-list{margin-top:0}strong{font-weight:700}ol,ul{padding-left:3ch}.footnotes>ol{margin-top:1em}.footnotes li:not(.highlight){transition:background-color 1s}hr{border-style:solid;border-width:1.5px 0 0;border-radius:1px;border-color:var(--separator-color)}:not(pre)>code{white-space:pre;background-color:var(--inline-code-bg)}li{padding-left:0}blockquote{quotes:none}blockquote:before,blockquote:after,q:before,q:after{content:"";content:none}a,a:active,a:visited{text-decoration:none}a:hover{text-decoration:underline}blockquote{padding:0 0 0 var(--content-padding);border-left:solid 2px var(--blockquote-accent)}aside{--content-padding:0.5em;padding:.5em;border-radius:var(--box-radius);background-color:var(--aside-bg)}a,a:active,header a:visited,footer a:visited,h1 a:visited{color:var(--link)}a:visited{color:var(--link-visited)}a.footnote-ref:visited,a.footnote-backref:visited,.notation-help-link-container a:visited{color:var(--link)}h1{font-size:130%}h2{font-size:120%}main *+p,main *+pre,main *+aside,main *+section,main *+article,main *+blockquote,main *+div,main *+ul,main *+ol,main *+hr,main *+h1,main *+h2{margin-top:1em}main .post-header *+h1{margin-top:0}code{font-family:Menlo,monospace;padding:0 3px;border-radius:2px}pre{background-color:var(--code-block-bg);font-size:11pt;padding:calc(.75*var(--content-padding)) var(--content-padding);line-height:1.3;border-radius:var(--box-radius);overflow-x:scroll;-webkit-overflow-scrolling:touch}pre code{padding:0;border-radius:0;display:inline-block;background-color:initial}p+p{margin-top:1em}body{margin:0 auto;--content-padding:10px;max-width:768px;-webkit-text-size-adjust:100%;position:relative}header{position:relative}header>*{height:48px;line-height:48px}.promo,.promo:visited,.promo:active{display:block;text-align:center;background-color:var(--link);color:var(--code-block-bg);border-radius:0 0 var(--outer-box-radius) var(--outer-box-radius)}header .site-title{font-size:130%}header nav{position:absolute;right:30px;top:0}@media all and (max-width:400px){:root{--outer-box-radius:0}header{text-align:center}header nav{position:static}:not(pre)>code{white-space:pre-wrap}body{--content-padding:10px}#dmt{padding:0;text-align:center;width:40px}}header ul{padding:0}header li{list-style:none;display:inline-block}header a{display:block;height:100%}header li+li{margin-left:1em}footer{padding:2em 0;font-size:.85em;text-align:center}article h1.post-title{font-size:200%}article .post-title a{display:block}article .meta{font-size:90%;font-style:italic}.post-header h1{line-height:1.2em;margin-bottom:.5em}.post-footer{text-align:center}.post-footer a{display:block}ol.post-list{list-style-position:inside;padding:0}.series-rider .series-name{font-style:italic}.highlight{color:var(--palette-text)}.highlight .k{color:var(--palette-purple)}.highlight .o{color:var(--palette-teal)}.highlight .p{color:var(--palette-text)}.highlight .c1{color:var(--palette-dim)}.highlight .nb{color:var(--palette-text)}.highlight .nv{color:var(--palette-red)}.highlight .s2{color:var(--palette-green)}.highlight .si{color:var(--palette-orange)}</style>
<meta property=og:title content="How to Learn Nix, Part 4: Quick starts, full hearts">
<meta property=og:type content=website>
<meta property=og:url content=https://ianthehenry.com/posts/how-to-learn-nix/quick-start-guide/>
<meta name=description content="I start reading through the Nix manual. I won‚Äôt quote it in its entirety like I did in the glossary. But I will any time I want to highlight something or I have a question or I don‚Äôt understand something.">
<meta property=og:description content="I start reading through the Nix manual. I won‚Äôt quote it in its entirety like I did in the glossary. But I will any time I want to highlight something or I have a question or I don‚Äôt understand something.">
<meta property=og:image content=https://ianthehenry.com/checkerboard.png>
<meta name=twitter:creator content=@ianthehenry>
<meta name=twitter:card content=summary>
<link type=image/x-icon rel="shortcut icon" href="data:image/vnd.microsoft.icon;base64,AAABAAEAEBAAAAEAIABoBAAAFgAAACgAAAAQAAAAIAAAAAEAIAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAHH1uIDShg/xEsZv8GFk3/CSJb/wgZT/8IGU//CBlP/wkiW/8HGE7/CBlP/wkiW/8HIFX/BxhO/wcgVf8OK2t7JDhz/wcfW/8NNn7/CSpq/wkjYf8MJGP/DCJg/w02ef9SqdX/TKHJ/1my2f9Moc3/UqzV/1Cr1v9Pocf/Ditr/xk2cf8KJGL/CjR8/wwva/8RK2r/Cido/w8qa/8LLW//TqjT/1Gnz/9bsNf/Sp/K/1Wt2f9Wrtj/UKjQ/w8xc/8gPHj/Di5w/xk4ef8TL27/Dy5u/xU3fv8QLGv/Ditr/1qy3f9dttv/Yrje/0ecx/9Knsz/U6fQ/1m13f8YN3n/JjZx/wszdv8YOXz/Eilm/xc3e/8dSZT/GDJz/xk/hv9hu+P/WbHZ/1mv1v9Kn8z/WLHd/1212v9ds9n/Eipr/xcqYv8SOX3/GzRz/xQrZ/8aM3D/HEuU/xc0df8fPYD/Yrre/1603P9dt9z/VKvY/1iz4v9etNr/Y73m/xk5fP8cMm3/JEWK/xc0dP8eO3v/Hjd4/ydRnP8WM3P/Gjd3/2bA5/9dtd//Ybng/2K95v9ct+P/Ybnf/2K95/8oS5L/GChg/xxBh/8lSIz/GC5s/yM5ev8hRoz/HTp7/yE6e/9Zsdz/YLzn/2jF7v9ryfL/YLzn/1qu1f9htdz/GDyD/y0/ev9qx/X/acDn/1235v9euun/Yb3r/1665v9owu7/GUOL/yhGh/8nUJL/MkmI/yBFiP8jOHb/MVag/yM+gv8VMGv/acXx/27G7/9szv3/bMb1/2zD6/9vy/X/edf5/yBHjv8yS47/JEuO/zVLiv8nS5D/LkOB/yRXpP8lQoT/H0WI/3fS+P910Pf/b8/8/2bB7/991Pn/eNb+/3nT+P8pS5L/O1GS/ytUnP86UJH/NF2k/zNLjP8sXKv/JkCB/x4+ff+B2/3/etT9/4He//922f//fNf//3TT//991/7/NU6N/zZSkP86Zav/PlWR/zFepv88ZKb/MF2n/yQ/gf8bNXH/fd3//3/b//+K6P//ft///3vV//993f//gdz//0hWlf9FZKX/RmOj/0JXlv9IeMP/QXKz/0Jsuf8eO3z/Hjt2/3vd//+C3v//ju3//3zg//+H4v//guL//4nj//9HXp3/UGur/ztgqf9JYqP/S3G4/05ur/9EbLT/Hjt7/zNJhf+G4///heT//4rq//+E5///iOT//4jr//+G4///UXO0/09iov9EX6H/SWWn/1V5wP9Kaa7/RGSp/ydLj/8NKGCfDShg/x8+d/8RLGb/CBlP/wYWTf8GFEj/CBNH/wooZP8JIlv/CCJd/woWSf8HGE7/ByBV/wwgU/8fO3mfAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA=="><meta http-equiv=content-security-policy content="default-src 'none'; font-src 'self' data:; img-src 'self' data:; style-src 'unsafe-inline'; media-src 'self' data:; script-src 'unsafe-inline' data:; object-src 'self' data:; frame-src 'self' data:;"><style>img[src="data:,"],source[src="data:,"]{display:none!important}</style></head>
<body class=content-page>
<a class=promo href=https://janet.guide/ target=_blank><i>psst, hey kid, wanna read a weird programming book</i></a>
<header>
<a class=site-title href=https://ianthehenry.com/>Ian Henry</a>
<nav>
<ul><li><a href=https://ianthehenry.com/about/>About</a><li><a href=https://ianthehenry.com/posts/>Blog</a><li><a href=https://ianthehenry.com/stuff/>Stuff</a></ul>
</nav>
<button id=dmt title="Toggle dark mode"></button>
</header>
<main>
<aside class=series-rider>
<p>This post is part of the series <a class=series-name href=https://ianthehenry.com/posts/how-to-learn-nix/>How to Learn Nix</a>, a rambling diary in which I work my way through the Nix manual in excrutiating detail.</p>
</aside>
<article class=post>
<div class=post-header>
<time class=meta datetime=2021-03-04>March 4, 2021</time>
<h1 class=post-title>
<a href=https://ianthehenry.com/posts/how-to-learn-nix/quick-start-guide/>How to Learn Nix, Part&nbsp;4:<br>Quick starts, full hearts</a></h1>
</div>
<div class=post-content><p>I start reading through the Nix manual. I won‚Äôt quote it in its entirety like I did in the glossary. But I will any time I want to highlight something or I have a question or I don‚Äôt understand something.</p>
<h1 id=chapter-1-about-nixhttpswebarchiveorgweb20210227145624httpsnixosorgmanualnixstablechap-introduction><a href=https://web.archive.org/web/20210227145624/https://nixos.org/manual/nix/stable/#chap-introduction>Chapter 1. About Nix</a></h1>
<p>This is mostly a feature tour ‚Äì sort of explaining what Nix is and why you should use it. There‚Äôs very little actual information about how Nix works, but it does prime the mind with a few questions.</p>
<p>The first I have is about rollbacks:</p>
<blockquote>
<pre><code>$ nix-env --upgrade some-packages
$ nix-env --rollback
</code></pre>
</blockquote>
<p>What exactly does it mean to roll back a package?</p>
<p>I remember from the glossary that the user environment is a bunch of symlinks to executables. Presumably rolling back packages means changing the symlinks back. But how does it know what they were before? I suspect the ‚ÄúNix database‚Äù keeps track of this, but I will have to wait to see if I am right.</p>
<p>I then notice that everything in the manual seems to use the ‚Äúold‚Äù style of commands. One of the reasons I was excited to return to Nix was the prospect of a more user-friendly command-line interface ‚Äì the <code>nix</code> executable. So I‚Äôm surprised that the manual, at least in the introduction, doesn‚Äôt use it. All the examples are of the ‚Äúold style‚Äù commands, like <code>nix-env</code> and <code>nix-shell</code>.</p>
<p>I suspect this is just documentation rot, but Nix 2.0 came out in the beginning of 2018, and I‚Äôm writing this in 2021, so if I got the math right that‚Äôs not super reassuring. Either the rest of the manual is going to be quite outdated as well, or the <code>nix</code> interface is still not considered stable enough for real world use. I suppose I will find out in the rest of the manual.</p>
<p>Moving on, we get to ‚Äútransparent source/binary deployment,‚Äù which basically says that prebuilt binaries will be fetched from <code>https://cache.nixos.org/</code>. It doesn‚Äôt say <em>why</em> or how to configure that ‚Äì I assume I can set up my own custom cache? That domain is not magical, I hope? This is of course fine for an introduction, but something that I will need to follow up on for my own understanding.</p>
<p>We see a brief introduction to <code>nix-shell</code>, which includes our first truly confounding command, which is not explained at all:</p>
<blockquote>
<pre><code>$ nix-shell '&lt;nixpkgs&gt;' -A pan
</code></pre>
</blockquote>
<p>(<code>pan</code>, in case you aren‚Äôt following along with the manual at home, is an example package ‚Äì <a href=https://pan.rebelbase.com/>a Gnome Usenet client, I guess</a>.)</p>
<p>What is <code>-A</code>? Elsewhere in the manual there they use long flags, but here we get an abbreviation, which is a pet peeve of mine to see in documentation, so I will expand it for you:</p>
<pre><code>$ nix-shell '&lt;nixpkgs&gt;' --attr pan
</code></pre>
<p>And it‚Äôs no more clear. We want to start a shell with <code>pan</code> installed, but we specify it as <code>--attr</code>? Huh?</p>
<p>I think this is a great example where there is a disconnect between the way that I think about things (‚ÄúI want a shell with this package in it‚Äù) and what Nix needs me to say (‚ÄúI want a shell with this particular named symbol, or maybe record element or something, which I call an attribute, to be available, and because that attribute refers to a derivation or something that package will ultimately be installed.") I am, obviously, guessing here, helped only by a very shaky memory. Maybe that‚Äôs not what it means.</p>
<p>More confusing is the <code>&lt;nixpkgs&gt;</code> line. What do those angle brackets mean?<sup id=fnref:1><a href=#fn:1 class=footnote-ref role=doc-noteref>1</a></sup> Why is that an anonymous argument, when <code>--attr</code> was named?</p>
<p>I vaguely recall that this is some sort of <code>import</code> or <code>open</code> statement or something, which includes the definition of the symbol (attribute?) <code>pan</code>. But I have no idea what the <code>nixpkgs</code> string actually refers to: is that a filename somewhere? Is it the name of a channel? I don‚Äôt think I‚Äôve forgotten this: I think I never really understood what that meant.</p>
<h1 id=chapter-2-quick-starthttpswebarchiveorgweb20210227145624httpsnixosorgmanualnixstablechap-quick-start><a href=https://web.archive.org/web/20210227145624/https://nixos.org/manual/nix/stable/#chap-quick-start>Chapter 2. Quick Start</a></h1>
<p>This chapter begins with a great line:</p>
<blockquote>
<p>This chapter is for impatient people who don‚Äôt like reading documentation.</p>
</blockquote>
<p>Being the exact opposite of that person, I wondered if I should skip it, but decided that would be foolish. This is probably the most commonly read section in the manual. If anything should be improved to make Nix adoption easier, it‚Äôs this.</p>
<h2 id=installation>Installation</h2>
<p>First we see the install instructions:</p>
<blockquote>
<pre><code>$ bash &lt;(curl -L https://nixos.org/nix/install)
</code></pre>
</blockquote>
<p>I think I speak for all of us when I say: really? Yeah, this is what Homebrew does, but isn‚Äôt Nix like‚Ä¶ hardcore? Shouldn‚Äôt we be looking down our noses at people who suggest we <em>run code</em> that we found <em>on the internet?</em> It‚Äôs not like we‚Äôre about to give this software total control over our computer to do whatever it okay fine.</p>
<p>I am pleased to see that the main install page at least gives instructions for how to verify that the installation script has not been tampered with:</p>
<blockquote>
<pre><code>$ curl -o install-nix-2.3.10 https://releases.nixos.org/nix/nix-2.3.10/install
$ curl -o install-nix-2.3.10.asc https://releases.nixos.org/nix/nix-2.3.10/install.asc
$ gpg2 --recv-keys B541D55301270E0BCF15CA5D8170B4726D7198DE
$ gpg2 --verify ./install-nix-2.3.10.asc
$ sh ./install-nix-2.3.10
</code></pre>
</blockquote>
<p>Probably. I mean, who knows? Has anyone ever actually done that? <em>Have you really?</em> Do you even have <code>gpg2</code> installed? Don‚Äôt you lie to me.</p>
<p>So it‚Äôs probably fine. You can see that this script just downloads another script and executes that, and like, I‚Äôm not gonna read <em>that</em> script too. I‚Äôve got docs to read.</p>
<p>So let‚Äôs try it out:</p>
<pre><code>$ bash &lt;(curl -L https://nixos.org/nix/install)
(some curl progress)
Note: a multi-user installation is possible. See https://nixos.org/nix/manual/#sect-multi-user-installation

Installing on macOS &gt;=10.15 requires relocating the store to an apfs volume.
Use sh &lt;(curl -L https://nixos.org/nix/install) --darwin-use-unencrypted-nix-store-volume or run the preparation steps manually.
See https://nixos.org/nix/manual/#sect-macos-installation
</code></pre>
<p>Okay. That did not work, and redirected me to a couple of different manual sections. I don‚Äôt particularly care about a multi-user installation on my laptop ‚Äì I am the only user ‚Äì so I skipped that and went on to read about the macOS problem.</p>
<p>And I learn that apparently I cannot just make <code>/nix</code> anymore.</p>
<pre><code>$ mkdir /nix
mkdir: /nix: Read-only file system
</code></pre>
<p>They ain‚Äôt lyin'.</p>
<p>So that‚Äôs not great. The manual provides a few options to get around this:</p>
<ol>
<li>Change the Nix store path prefix</li>
</ol>
<p>Which means forgoing binary caches, which makes this an absolute nonstarter for me. Ain‚Äôt nobody got time for that.</p>
<ol start=2>
<li>Use a separate encrypted volume</li>
</ol>
<p>This sounds <em>fine</em>, but annoying, as certain things won‚Äôt be available immediately after booting, which could cause weird failures if I have software configured to run immediately. But I hardly ever reboot, so this doesn‚Äôt sound that bad.</p>
<ol start=3>
<li>Symlink the Nix store to a custom location</li>
</ol>
<p>The manual basically just says ‚Äúthis don‚Äôt work.‚Äù</p>
<ol start=4>
<li>Use a separate unencrypted volume</li>
</ol>
<p>This is given as the recommended command above, but the manual explains what it is and how to do it.</p>
<p>I have to say, I‚Äôm incredibly impressed by this manual section. This is great. It makes me feel good; it puts me at ease; it gives me reassurance that the people behind Nix spent time thinking about this problem and the best ways to solve it.</p>
<p>And having read their recommendation, I concur with their conclusion, and will run the recommended command:</p>
<pre><code>$ sh &lt;(curl -L https://nixos.org/nix/install) --darwin-use-unencrypted-nix-store-volume
</code></pre>
<p>Uninstallation is now more complicated than <code>rm -r /nix</code>, but the script tells me what I need to do. Because I will definitely forget and am not sure if these steps will be documented anywhere else, I write them down in my blog:</p>
<pre tabindex=0><code>Creating volume and mountpoint /nix.

     ------------------------------------------------------------------
    | This installer will create a volume for the nix store and        |
    | configure it to mount at /nix.  Follow these steps to uninstall. |
     ------------------------------------------------------------------

  1. Remove the entry from fstab using 'sudo vifs'
  2. Destroy the data volume using 'diskutil apfs deleteVolume'
  3. Remove the 'nix' line from /etc/synthetic.conf or the file
</code></pre><p>Unfortunately, the script fails shortly after that.</p>
<pre tabindex=0><code>error: refusing to create Nix store volume because the boot volume is
       FileVault encrypted, but encryption-at-rest is not available.
       Manually create a volume for the store and re-run this script.
       See https://nixos.org/nix/manual/#sect-macos-installation
</code></pre><p>I don‚Äôt know what that means. What is encryption-at-rest? I do not know. The manual mentioned something about ‚ÄúT2 chips,‚Äù but I don‚Äôt know what that means either. It sure sounds futuristic, though, and my laptop is still powered by steam, so I‚Äôd be very surprised if I have one of those.</p>
<p>I try to create the volume manually, following the instruction in the manual, but that too gives me an error:</p>
<pre><code>$ sudo diskutil apfs addVolume diskX APFS 'Nix Store' -mountpoint /nix
Could not find APFS Container Reference diskX
</code></pre>
<p>Boo. What looked like a command to run was in fact the <em>template</em> for a command to run, which I did not know because I don‚Äôt know the first thing about the <code>diskutil</code> CLI.</p>
<p><code>diskutil list</code> tells me I have <code>disk0</code> and <code>disk1</code>. Which one is the elusive <code>diskX</code>? I don‚Äôt know.</p>
<pre tabindex=0><code>$ diskutil list
/dev/disk0 (internal, physical):
   #:                       TYPE NAME                    SIZE       IDENTIFIER
   0:      GUID_partition_scheme                        *121.3 GB   disk0
   1:                        EFI EFI                     209.7 MB   disk0s1
   2:                 Apple_APFS Container disk1         121.1 GB   disk0s2

/dev/disk1 (synthesized):
   #:                       TYPE NAME                    SIZE       IDENTIFIER
   0:      APFS Container Scheme -                      +121.1 GB   disk1
                                 Physical Store disk0s2
   1:                APFS Volume Macintosh HD - Data     68.8 GB    disk1s1
   2:                APFS Volume Preboot                 365.1 MB   disk1s2
   3:                APFS Volume Recovery                613.7 MB   disk1s3
   4:                APFS Volume VM                      3.2 GB     disk1s4
   5:                APFS Volume Macintosh HD            19.5 GB    disk1s5
   6:              APFS Snapshot com.apple.os.update-... 19.5 GB    disk1s5s1
</code></pre><p><code>man diskutil</code> tells me that the first argument to <code>addVolume</code> should be the <code>containerReferenceDevice</code>. I make a weak pattern-matching guess that that should be <code>disk1</code>, and hope that I‚Äôm not about to brick my computer:</p>
<pre tabindex=0><code>$ sudo diskutil apfs addVolume disk1 APFS 'Nix Store' -mountpoint /nix
Password: hunter2
Will export new APFS Volume "Nix Store" from APFS Container Reference disk1
Started APFS operation on disk1
Preparing to add APFS Volume to APFS Container disk1
Creating APFS Volume
Created new APFS Volume disk1s7
Mounting disk
Setting volume permissions
Disk from APFS operation: disk1s7
Finished APFS operation on disk1
</code></pre><p>That looks‚Ä¶ good? I guess? <code>diskutil list</code> now includes my <code>Nix Store</code> volume. My computer did not start emitting smoke or noxious fumes. Let‚Äôs re-run the install command:</p>
<pre tabindex=0><code>$ sh &lt;(curl -L https://nixos.org/nix/install) --darwin-use-unencrypted-nix-store-volume
(buncha curl stuff)
Using existing 'Nix Store' volume
Configuring /etc/fstab...
123
164
performing a single-user installation of Nix...
copying Nix to /nix/store.............................................
installing 'nix-2.3.10'
building '/nix/store/h37hlzjs8grkr2d6zzl8yv9j459k0zy2-user-environment.drv'...
created 7 symlinks in user environment
installing 'nss-cacert-3.49.2'
building '/nix/store/z1mna9c241jqw3raldq0cpqi6z9f9zr9-user-environment.drv'...
created 9 symlinks in user environment
unpacking channels...
created 1 symlinks in user environment
modifying /Users/ian/.zshenv...

Installation finished!  To ensure that the necessary environment
variables are set, either log in again, or type

  . /Users/ian/.nix-profile/etc/profile.d/nix.sh

in your shell.
</code></pre><p>And it worked! 123 164!</p>
<p>I am now the proud owner of <code>nix-2.3.10</code>.</p>
<p>I don‚Äôt <em>love</em> that it modified <code>.zshenv</code> for me, though my inner pedant is reluctantly pleased that it didn‚Äôt modify <code>.zshrc</code> instead. The only modification is to source that script it mentions, so let‚Äôs go through that and see if we understand what it‚Äôs doing.</p>
<div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=k>if</span> <span class=o>[</span> -n <span class=s2>"</span><span class=nv>$HOME</span><span class=s2>"</span> <span class=o>]</span> <span class=o>&amp;&amp;</span> <span class=o>[</span> -n <span class=s2>"</span><span class=nv>$USER</span><span class=s2>"</span> <span class=o>]</span><span class=p>;</span> <span class=k>then</span>

    <span class=c1># Set up the per-user profile.</span>
    <span class=c1># This part should be kept in sync with nixpkgs:nixos/modules/programs/shell.nix</span>

    <span class=nv>NIX_LINK</span><span class=o>=</span><span class=nv>$HOME</span>/.nix-profile

    <span class=c1># Append ~/.nix-defexpr/channels to $NIX_PATH so that &lt;nixpkgs&gt;</span>
    <span class=c1># paths work when the user has fetched the Nixpkgs channel.</span>
    <span class=nb>export</span> <span class=nv>NIX_PATH</span><span class=o>=</span><span class=si>${</span><span class=nv>NIX_PATH</span><span class=p>:+</span><span class=nv>$NIX_PATH</span><span class=p>:</span><span class=si>}</span><span class=nv>$HOME</span>/.nix-defexpr/channels

    <span class=c1># Set up environment.</span>
    <span class=c1># This part should be kept in sync with nixpkgs:nixos/modules/programs/environment.nix</span>
    <span class=nb>export</span> <span class=nv>NIX_PROFILES</span><span class=o>=</span><span class=s2>"/nix/var/nix/profiles/default </span><span class=nv>$HOME</span><span class=s2>/.nix-profile"</span>

    <span class=c1># Set $NIX_SSL_CERT_FILE so that Nixpkgs applications like curl work.</span>
    <span class=k>if</span> <span class=o>[</span> -e /etc/ssl/certs/ca-certificates.crt <span class=o>]</span><span class=p>;</span> <span class=k>then</span> <span class=c1># NixOS, Ubuntu, Debian, Gentoo, Arch</span>
        <span class=nb>export</span> <span class=nv>NIX_SSL_CERT_FILE</span><span class=o>=</span>/etc/ssl/certs/ca-certificates.crt
    <span class=k>elif</span> <span class=o>[</span> -e /etc/ssl/ca-bundle.pem <span class=o>]</span><span class=p>;</span> <span class=k>then</span> <span class=c1># openSUSE Tumbleweed</span>
        <span class=nb>export</span> <span class=nv>NIX_SSL_CERT_FILE</span><span class=o>=</span>/etc/ssl/ca-bundle.pem
    <span class=k>elif</span> <span class=o>[</span> -e /etc/ssl/certs/ca-bundle.crt <span class=o>]</span><span class=p>;</span> <span class=k>then</span> <span class=c1># Old NixOS</span>
        <span class=nb>export</span> <span class=nv>NIX_SSL_CERT_FILE</span><span class=o>=</span>/etc/ssl/certs/ca-bundle.crt
    <span class=k>elif</span> <span class=o>[</span> -e /etc/pki/tls/certs/ca-bundle.crt <span class=o>]</span><span class=p>;</span> <span class=k>then</span> <span class=c1># Fedora, CentOS</span>
        <span class=nb>export</span> <span class=nv>NIX_SSL_CERT_FILE</span><span class=o>=</span>/etc/pki/tls/certs/ca-bundle.crt
    <span class=k>elif</span> <span class=o>[</span> -e <span class=s2>"</span><span class=nv>$NIX_LINK</span><span class=s2>/etc/ssl/certs/ca-bundle.crt"</span> <span class=o>]</span><span class=p>;</span> <span class=k>then</span> <span class=c1># fall back to cacert in Nix profile</span>
        <span class=nb>export</span> <span class=nv>NIX_SSL_CERT_FILE</span><span class=o>=</span><span class=s2>"</span><span class=nv>$NIX_LINK</span><span class=s2>/etc/ssl/certs/ca-bundle.crt"</span>
    <span class=k>elif</span> <span class=o>[</span> -e <span class=s2>"</span><span class=nv>$NIX_LINK</span><span class=s2>/etc/ca-bundle.crt"</span> <span class=o>]</span><span class=p>;</span> <span class=k>then</span> <span class=c1># old cacert in Nix profile</span>
        <span class=nb>export</span> <span class=nv>NIX_SSL_CERT_FILE</span><span class=o>=</span><span class=s2>"</span><span class=nv>$NIX_LINK</span><span class=s2>/etc/ca-bundle.crt"</span>
    <span class=k>fi</span>

    <span class=k>if</span> <span class=o>[</span> -n <span class=s2>"</span><span class=si>${</span><span class=nv>MANPATH</span><span class=p>-</span><span class=si>}</span><span class=s2>"</span> <span class=o>]</span><span class=p>;</span> <span class=k>then</span>
        <span class=nb>export</span> <span class=nv>MANPATH</span><span class=o>=</span><span class=s2>"</span><span class=nv>$NIX_LINK</span><span class=s2>/share/man:</span><span class=nv>$MANPATH</span><span class=s2>"</span>
    <span class=k>fi</span>

    <span class=nb>export</span> <span class=nv>PATH</span><span class=o>=</span><span class=s2>"</span><span class=nv>$NIX_LINK</span><span class=s2>/bin:</span><span class=nv>$PATH</span><span class=s2>"</span>
    <span class=nb>unset</span> NIX_LINK
<span class=k>fi</span>
</code></pre></div><p>Well, that‚Äôs a lot of things. Let‚Äôs try to go through the important bits.</p>
<div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=c1># Append ~/.nix-defexpr/channels to $NIX_PATH so that &lt;nixpkgs&gt;</span>
<span class=c1># paths work when the user has fetched the Nixpkgs channel.</span>
<span class=nb>export</span> <span class=nv>NIX_PATH</span><span class=o>=</span><span class=si>${</span><span class=nv>NIX_PATH</span><span class=p>:+</span><span class=nv>$NIX_PATH</span><span class=p>:</span><span class=si>}</span><span class=nv>$HOME</span>/.nix-defexpr/channels
</code></pre></div><p>No idea what this means. No idea what <code>NIX_PATH</code> is or why it‚Äôs being appended to when, as far as I know, it does not currently exist. Why not set it to that? I guess to not be destructive if the user configures something in their own <code>.zshenv</code>. But what would I configure it to? What is <code>NIX_PATH</code>?</p>
<p>Beyond that, what is <code>$HOME/.nix-defexpr</code>? It just contains a couple symlinks:</p>
<pre tabindex=0><code>$ tree ~/.nix-defexpr
/Users/ian/.nix-defexpr
‚îú‚îÄ‚îÄ channels -&gt; /nix/var/nix/profiles/per-user/ian/channels
‚îî‚îÄ‚îÄ channels_root -&gt; /nix/var/nix/profiles/per-user/root/channels
</code></pre><p>No idea what the purpose of those are. Apparently this has something to do with the mysterious <code>&lt;nixpkgs&gt;</code> syntax we saw in the <code>nix-shell</code> example, but I can‚Äôt begin to guess what. I wonder what <code>defexpr</code> means: ‚Äúdef‚Äù means ‚Äúdefinition‚Äù to me, but together I‚Äôm leaning towards ‚Äúdefault expression.‚Äù If so, I wish that this were called <code>~/.nix-default-expression</code>. I wonder what that means, so I will add it as an open question.</p>
<p>Next:</p>
<div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=c1># Set up environment.</span>
<span class=c1># This part should be kept in sync with nixpkgs:nixos/modules/programs/environment.nix</span>
<span class=nb>export</span> <span class=nv>NIX_PROFILES</span><span class=o>=</span><span class=s2>"/nix/var/nix/profiles/default </span><span class=nv>$HOME</span><span class=s2>/.nix-profile"</span>
</code></pre></div><p>Okay. Neat. I don‚Äôt know what it means about keeping this in sync with something, nor do I really recognize <code>nixpkgs:nixos/modules/programs/environment.nix</code> as, like, a path to something. Is <code>nixpkgs:</code> a namespace here? Is this a file? It reads like a protocol to me. But it‚Äôs gotta be a file, right? I don‚Äôt know.</p>
<p>Next there‚Äôs a long section around configuring SSL certificates.</p>
<p>I have a strong recollection of SSL certs <em>not working</em> when I used Nix before, which made every <code>nix-env</code> invocation fail, I think ‚Äì or maybe just <code>nix-channel</code> commands? ‚Äì I don‚Äôt remember. I had to do some nonsense to set some environment variable manually (presumably <code>NIX_SSL_CERT_FILE</code>, but I don‚Äôt actually remember). So maybe these lines are new since I last tried Nix? Or they weren‚Äôt working on OS X? I don‚Äôt know. We shall see if they work on macOS now.</p>
<p>Then the script sets up <code>PATH</code> and <code>MANPATH</code>. No objection to any of this. Let‚Äôs source it.</p>
<pre><code>$ source ~/.nix-profile/etc/profile.d/nix.sh
</code></pre>
<p>Isn‚Äôt that nicer to read than the <code>.</code> syntax? I think so. There‚Äôs probably some ancient reason to prefer <code>.</code> over <code>source</code> if you‚Äôre running Plan 9 on a Commodore 64 or whatever people used to do before Steve Jobs came along and saved us all from having to know anything about computers.</p>
<p>Anyway, everything is working great now. Nix is installed!</p>
<h2 id=first-steps>First steps</h2>
<p>The quick start goes on to describe some simple commands to try. Let‚Äôs start with the first one, to ‚Äúsee what installable packages are currently available in the channel‚Äù:</p>
<pre><code>$ nix-env -qa
</code></pre>
<p>This command appears to just hang. No output at all. Is it working? Does it do anything? Ah, after thirty seconds or so it gives me a big list of words in a pager. How many words? <em>Countless thousands</em>. Actually 32,544. That‚Äôs too many!</p>
<p>As my first ever real live Nix command, I gotta say‚Ä¶ this is not a very good showcase. I do not care to see the 32,544 packages that make up the Nix ecosystem. I care to see, like, a couple dozen of them, tops.</p>
<p>But still, sure, okay. The manual authors wanted to highlight this command; I should at least understand it.</p>
<pre><code>$ nix-env -qa
</code></pre>
<p>The <code>-q</code> flag is for ‚Äúquery‚Äù and not ‚Äúquiet‚Äù as I would assume from every other CLI I have ever used. Similarly <code>a</code> does not stand for <code>--all</code> but <code>--available</code>. The man page explains:</p>
<pre tabindex=0><code>OPERATION --QUERY
   Synopsis
       nix-env {--query | -q} [--installed | --available | -a]
               [{--status | -s}] [{--attr-path | -P}] [--no-name] [{--compare-versions | -c}] [--system] [--drv-path] [--out-path]
               [--description] [--meta]
               [--xml] [--json] [{--prebuilt-only | -b}] [{--attr | -A} attribute-path]
               names...

   Description
       The query operation displays information about either the store paths that are installed in the current generation of the active
       profile (--installed), or the derivations that are available for installation in the active Nix expression (--available). It only
       prints information about derivations whose symbolic name matches one of names.

       The derivations are sorted by their name attributes.

   Source selection
       The following flags specify the set of things on which the query operates.

       --installed
           The query operates on the store paths that are installed in the current generation of the active profile. This is the default.

       --available, -a
           The query operates on the derivations that are available in the active Nix expression.
</code></pre><p>So my query was for ‚Äúderivations that are available in the active Nix expression‚Äù ‚Äì whatever that means ‚Äì and I didn‚Äôt have an actual query, so I got back everything. Okay. Let‚Äôs try it with a string:</p>
<pre><code>$ nix-env -qa git
git-2.30.0
git-2.30.0
git-2.30.0
</code></pre>
<p>After thirty more seconds, I get the same package, three times. All the same version. Huh. Okay. That‚Äôs weird.</p>
<p>In my head and from my memory, this command is analogous to <code>brew search</code>. I can run <code>brew search git</code> and get back not just git, but lots of packages with the string ‚Äúgit‚Äù in the name, like <code>git-annex</code> and something called <code>gitmoji</code>. Are these packages not available in Nix?</p>
<pre><code>$ nix-env -qa git-annex
git-annex-8.20210127
</code></pre>
<p>Huh? Okay. So I guess‚Ä¶ it‚Äôs not really searching? The string I‚Äôm giving it is something else?</p>
<p>Well. Weird. But we all know that Nix traditionally has a pretty confusing ‚Äì if not outright hostile ‚Äì user interface. But that‚Äôs one of the big reasons we‚Äôre returning to it now, with Nix 2! We have new commands! So let‚Äôs try one now.</p>
<pre><code>$ nix search git
warning: using cached results; pass '-u' to update the cache
error: no results for the given search term(s)!
</code></pre>
<p>Um. Okay. I suppose that since I‚Äôve never run this before, my cache is empty? And it searched it anyway, instead of auto-updating it? Sure.</p>
<pre tabindex=0><code>$ nix search git -u
* nixpkgs.act (act-0.2.20)
  Run your GitHub Actions locally

* nixpkgs.argocd (argocd-1.8.4)
  Argo CD is a declarative, GitOps continuous delivery tool for Kubernetes

* nixpkgs.axoloti (axoloti-1.0.12-2)
  Sketching embedded digital audio algorithms.  To fix permissions of the Axoloti USB device node, add a similar udev rule to &lt;literal&gt;services.udev.extraRule
s&lt;/literal&gt;: &lt;literal&gt;SUBSYSTEM=="usb", ATTR{idVendor}=="16c0", ATTR{idProduct}=="0442", OWNER="someuser", GROUP="somegroup"&lt;/literal&gt;

(much more output elided)
</code></pre><p>It took the same amount of time, but the output I got was <em>leaps and bounds</em> better than with <code>nix-env -qa</code>. Not only did it search package names, but also searched and displayed package descriptions ‚Äì although with some apparent escaping issues.</p>
<p>It‚Äôs also very nicely colorized in ways that don‚Äôt show up here ‚Äì my search term is highlighted wherever it appears, the scary computer version of the package <code>(axoloti-1.0.12-2)</code> is nicely grayed out so that it doesn‚Äôt distract my eye. It looks great. And I love that they‚Äôre all namespaced with <code>nixpkgs</code> ‚Äì that makes me feel good; that makes things feel less magical. It makes me feel heard.</p>
<p>Scrolling through the output I see all kinds of git-related packages, including <code>git-annex</code> ‚Äì although, tragically, there is no <code>gitmoji</code>.</p>
<p>So, okay. It might be good if <code>nix search</code> was the first command you run, instead of <code>nix-env -qa</code>. It‚Äôs familiar. It does the thing you expect. It leaves a good first impression ‚Äì apart from having to re-run it with <code>-u</code>. But it told me that! It didn‚Äôt just silently give me nothing! The fact that I was able to use it successfully without googling anything means that the UI is working, even if my experience could have been a <em>little smoother</em>.</p>
<p>But doing this highlighted a weird and unexpected thing. I can run <code>man nix-env</code> and learn that the expanded version of that command is <code>nix-env --query --available</code>, which is easier to read. But there is no <code>man nix</code>. Weird. I want to learn more about <code>nix search -u</code>, so I run:</p>
<pre><code>$ nix help search
error: 'help' is not a recognised command
Try 'nix --help' for more information.
</code></pre>
<p>Because that‚Äôs how Homebrew works. And I am very pleased that it told me the correct command. So I run:</p>
<pre><code>$ nix search --help
</code></pre>
<p>And see that <code>-u</code> stands for <code>--update-cache</code>. <em>Perfect</em>. Love it. Super explicit. I was worried it would just stand for <code>--update</code>, and I would have something to grumble about.</p>
<p>All-in, <code>nix search</code>: five stars. <code>nix-env -qa</code>: three wats.</p>
<p>Let‚Äôs keep going.</p>
<p>The next command is listed as ‚Äúinstall some packages from the channel.‚Äù I still don‚Äôt know what a ‚Äúchannel‚Äù is, but okay.</p>
<pre><code>$ nix-env -i hello
</code></pre>
<p>Is <code>-i</code> short for <code>--interactive</code>? <code>--ignore</code>? No: it‚Äôs <code>--install</code>, another ‚Äúsubcommand‚Äù of <code>nix-env</code>. I‚Äôve gotta say, I really like the convention of subcommands not being flags. I‚Äôm glad we landed there. The world is a much better place now than it once was.</p>
<p>Anyway, let‚Äôs run it.</p>
<p>It‚Ä¶ is slow. Probably another 30 seconds before it starts printing anything. I‚Äôm starting to sense a pattern.</p>
<pre tabindex=0><code>$ nix-env -i hello
installing 'hello-2.10'
these paths will be fetched (14.84 MiB download, 74.75 MiB unpacked):
  /nix/store/2s8x59z3cly97fyc3hvlngl637snpwcq-swift-corefoundation
  /nix/store/541lzmhppr82600vz7ap54n22dz7gydf-ICU-66108
  /nix/store/5y6lcfjghk5kbv4782vi7w79vz60gsyn-bash-4.4-p23
  /nix/store/aqf78c2x1kwv9i123p55m3f4iyx9fz3c-openssl-1.1.1i
  /nix/store/c1ln5y1p009wn44j03z1r7rdhmjx3k2j-curl-7.74.0
  /nix/store/mw590ax8x2n9161hwvnl9j5156di6d47-libc++abi-7.1.0
  /nix/store/pakmb65sf3g2hkbm1fdgk2fh6hiij720-hello-2.10
  /nix/store/pqajcmw6jmq2i8ka001z53r1a09w4y67-libssh2-1.9.0
  /nix/store/q1rhw9f30fm0yzx1hic1hgj31sfc6k4p-libkrb5-1.18
  /nix/store/s5rd3hgdirrdwdfbn7m4hd0i3d2zqpz5-libxml2-2.9.10
  /nix/store/vrmgqjl51gwf47i5i1rbs7dnkb1g1pvf-libc++-7.1.0
  /nix/store/wphpzw2swy36pm4ph3r1zfvwfj2njxjf-zlib-1.2.11
  /nix/store/yi9klhxd1243l7inrkn12f6lwzp9bki4-Libsystem-1238.60.2
  /nix/store/zxya6i6ncqs8q6fq3mcl0igflmy2219n-nghttp2-1.41.0-lib
copying path '/nix/store/yi9klhxd1243l7inrkn12f6lwzp9bki4-Libsystem-1238.60.2' from 'https://cache.nixos.org'...
copying path '/nix/store/5y6lcfjghk5kbv4782vi7w79vz60gsyn-bash-4.4-p23' from 'https://cache.nixos.org'...
copying path '/nix/store/mw590ax8x2n9161hwvnl9j5156di6d47-libc++abi-7.1.0' from 'https://cache.nixos.org'...
copying path '/nix/store/q1rhw9f30fm0yzx1hic1hgj31sfc6k4p-libkrb5-1.18' from 'https://cache.nixos.org'...
copying path '/nix/store/vrmgqjl51gwf47i5i1rbs7dnkb1g1pvf-libc++-7.1.0' from 'https://cache.nixos.org'...
copying path '/nix/store/zxya6i6ncqs8q6fq3mcl0igflmy2219n-nghttp2-1.41.0-lib' from 'https://cache.nixos.org'...
copying path '/nix/store/541lzmhppr82600vz7ap54n22dz7gydf-ICU-66108' from 'https://cache.nixos.org'...
copying path '/nix/store/aqf78c2x1kwv9i123p55m3f4iyx9fz3c-openssl-1.1.1i' from 'https://cache.nixos.org'...
copying path '/nix/store/wphpzw2swy36pm4ph3r1zfvwfj2njxjf-zlib-1.2.11' from 'https://cache.nixos.org'...
copying path '/nix/store/pqajcmw6jmq2i8ka001z53r1a09w4y67-libssh2-1.9.0' from 'https://cache.nixos.org'...
copying path '/nix/store/s5rd3hgdirrdwdfbn7m4hd0i3d2zqpz5-libxml2-2.9.10' from 'https://cache.nixos.org'...
copying path '/nix/store/c1ln5y1p009wn44j03z1r7rdhmjx3k2j-curl-7.74.0' from 'https://cache.nixos.org'...
copying path '/nix/store/2s8x59z3cly97fyc3hvlngl637snpwcq-swift-corefoundation' from 'https://cache.nixos.org'...
copying path '/nix/store/pakmb65sf3g2hkbm1fdgk2fh6hiij720-hello-2.10' from 'https://cache.nixos.org'...
building '/nix/store/dgm6dvfqzvk0jf4r0qn3sbrfp8nn00w3-user-environment.drv'...
created 40 symlinks in user environment
</code></pre><p>Neat! 40 symlinks! For one command! Why!</p>
<p>So I look in <code>~/.nix-profile/bin/</code> ‚Äì the only Nix-flavored directory on my <code>PATH</code> ‚Äì and find just one new symlink: <code>hello</code>. So that‚Äôs good. Not sure where the other 39 symlinks got off to. Kind of a weird upsetting message, to be honest. But at least I now have <code>hello</code>.</p>
<pre><code>$ hello
Hello, world!
</code></pre>
<p>Excellent.</p>
<p>It then tells me how to uninstall a package, with ‚Äì you know what? I‚Äôm not going to tell you.</p>
<p>I want you to guess. <code>nix-env -u</code>, for uninstall? <code>nix-env -r</code>, for remove? <code>nix-env -d</code>, for delete?</p>
<p>No. None of this. It‚Äôs <code>nix-env -e</code>. The <code>-e</code> is short for, according to the manual, <code>--uninstall</code>. I am not making this up.</p>
<p>I sort of refuse to use <code>nix-env -e</code> on principal, and instead run it like this:</p>
<pre tabindex=0><code>$ nix-env --uninstall hello
uninstalling 'hello-2.10'
building '/nix/store/29hrprfz6bn7qnn39a5xjw3mm563xbxs-user-environment.drv'...
created 9 symlinks in user environment
</code></pre><p>What? You already created 40 symlinks to install it, you need 9 more just to uninstall it? This seems‚Ä¶ it seems like this message is telling me something very different from what I assume it is telling me.</p>
<p>But it worked!</p>
<pre><code>$ hello
zsh: command not found: hello
</code></pre>
<p>Rest in peace, friend.</p>
<p>Fortunately, the next example is to ‚Äútest out‚Äù a command by opening a shell that has the command available, without actually installing it (er, creating symlinks to it, I guess).</p>
<p>That looks like this (quite different from the <code>pan</code> example we saw before):</p>
<pre><code>$ nix-shell -p hello
</code></pre>
<p>And this installed <em>way more</em> than when I just ran <code>nix-env -i</code>. Like, <em>way more</em>. I won‚Äôt even include the output of the command because there was so much of it. For scale, this told me <code>(138.31 MiB download, 695.33 MiB unpacked)</code> vs <code>(14.84 MiB download, 74.75 MiB unpacked)</code> for <code>nix-env -i</code>. And I assume that <code>hello</code> itself was still around ‚Äì that uninstalling it didn‚Äôt actually delete the files, because I remember that much from years ago.</p>
<p>So that‚Äôs all‚Ä¶ overhead? Shell overhead? It‚Äôs not just <code>bash</code>? I do not know. The shell does seem to work, though:</p>
<pre><code>[nix-shell:~]$ hello
Hello, world!
</code></pre>
<p>Excellent.</p>
<p>Subsequent invocations of <code>nix-shell -p hello</code> don‚Äôt download anything, <em>but</em> the command still has to think for a solid 2 or 3 seconds before I get into my shell. Which is annoying.</p>
<p>So, okay. These seem like pretty important, common commands. Let‚Äôs see how they behave with the <code>nix</code> command line.</p>
<pre><code>$ nix install hello
error: 'install' is not a recognised command
Try 'nix --help' for more information.
</code></pre>
<p><em>Huh</em>.</p>
<p>I look through <code>nix --help</code>, but nothing sounds like <code>install</code> to me. There‚Äôs <code>build</code>? <code>add-to-store</code>? These don‚Äôt really sound like <code>install</code>. So I guess‚Ä¶ <code>nix-env</code> is still the only way to do this? Look for yourself:</p>
<pre tabindex=0><code>$ nix --help
Usage: nix &lt;COMMAND&gt; &lt;FLAGS&gt;... &lt;ARGS&gt;...

Common flags:
      --debug                  enable debug output
      --help                   show usage information
      --help-config            show configuration options
      --no-net                 disable substituters and consider all previously downloaded files up-to-date
      --option &lt;NAME&gt; &lt;VALUE&gt;  set a Nix configuration option (overriding nix.conf)
  -L, --print-build-logs       print full build logs on stderr
      --quiet                  decrease verbosity level
  -v, --verbose                increase verbosity level
      --version                show version information

In addition, most configuration settings can be overriden using '--&lt;name&gt; &lt;value&gt;'.
Boolean settings can be overriden using '--&lt;name&gt;' or '--no-&lt;name&gt;'. See 'nix
--help-config' for a list of configuration settings.

Available commands:
  add-to-store     add a path to the Nix store
  build            build a derivation or fetch a store path
  cat-nar          print the contents of a file inside a NAR file
  cat-store        print the contents of a store file on stdout
  copy             copy paths between Nix stores
  copy-sigs        copy path signatures from substituters (like binary caches)
  doctor           check your system for potential problems
  dump-path        dump a store path to stdout (in NAR format)
  edit             open the Nix expression of a Nix package in $EDITOR
  eval             evaluate a Nix expression
  hash-file        print cryptographic hash of a regular file
  hash-path        print cryptographic hash of the NAR serialisation of a path
  log              show the build log of the specified packages or paths, if available
  ls-nar           show information about the contents of a NAR file
  ls-store         show information about a store path
  optimise-store   replace identical files in the store by hard links
  path-info        query information about store paths
  ping-store       test whether a store can be opened
  repl             start an interactive environment for evaluating Nix expressions
  run              run a shell in which the specified packages are available
  search           query available packages
  show-config      show the Nix configuration
  show-derivation  show the contents of a store derivation
  sign-paths       sign the specified paths
  to-base16        convert a hash to base-16 representation
  to-base32        convert a hash to base-32 representation
  to-base64        convert a hash to base-64 representation
  to-sri           convert a hash to SRI representation
  upgrade-nix      upgrade Nix to the latest stable version
  verify           verify the integrity of store paths
  why-depends      show why a package has another package in its closure

Note: this program is EXPERIMENTAL and subject to change.
</code></pre><p>Boo. I‚Äôm actually pretty surprised by this. Nix 2 brings this new fancy interface, but it doesn‚Äôt bother to include a command to <em>install packages?</em> In a <em>package manager?</em> This is‚Ä¶ this does not bode well. I‚Äôm not sure how much Nix I can Nix if I have to type <code>nix-env -e</code> ever again. I realize there are no <em>laws</em> around user ergonomics for command line tools, but, like, doesn‚Äôt that feel a little bit like a violation of some kind of inalienable right?</p>
<p>I do see that there‚Äôs a <code>nix run</code> command. Let‚Äôs try that, as the description implies it‚Äôs like <code>nix-shell</code>:</p>
<pre><code>$ nix run hello
error: attribute 'hello' in selection path 'hello' not found
</code></pre>
<p>I don‚Äôt know what that means but it‚Äôs vaguely frightening. Ah, but the <code>--help</code> text has an example that gets me there:</p>
<pre tabindex=0><code>$ nix run nixpkgs.hello

The default interactive shell is now zsh.
To update your account to use zsh, please run `chsh -s /bin/zsh`.
For more details, please visit https://support.apple.com/kb/HT208050.
bash-3.2$ hello
Hello, world!
</code></pre><p>Wha? This is a very different shell than <code>nix-shell</code>. And for some reason tells me something about <code>zsh</code>. <code>zsh</code> has been my default interactive shell for‚Ä¶ ever. The link to an Apple support article makes me think this invoked the <em>system</em> <code>bash</code>? But that doesn‚Äôt sound like something <code>nix</code> would do. That‚Äôd be crazy. I guess all macOS builds link to an Apple support article? Weird. It prints it every time I use <code>nix run</code>, too! It‚Äôs not just a first-run message. So‚Ä¶ gross. This command seems <em>worse</em> than <code>nix-shell</code>.</p>
<p>Let‚Äôs move on. Next we learn how ‚Äúto keep up-to-date with the channel.‚Äù Still no idea what a channel actually is.</p>
<blockquote>
<pre><code>$ nix-channel --update nixpkgs
$ nix-env -u '*'
</code></pre>
</blockquote>
<p>The manual clarifies:</p>
<blockquote>
<p>The latter command will upgrade each installed package for which there is a ‚Äúnewer‚Äù version (as determined by comparing the version numbers).</p>
</blockquote>
<p>Okay. So I guess <code>nix-env</code> supports globs. Maybe that would make my <code>nix-env -qa git</code> search work.</p>
<pre><code>$ nix-env -qa '*git*'
error: An empty regex is not allowed in the POSIX grammar.
</code></pre>
<p>Amazingly, this <em>still took 30 seconds</em> to print that error. Which is a <em>syntax</em> error! What is that command <em>doing?</em></p>
<p>I dunno. But let‚Äôs try updating my channel:</p>
<pre><code>$ nix-channel --update nixpkgs
unpacking channels...
</code></pre>
<p>Pretty quick! No idea if it‚Ä¶ did anything. I only installed Nix like an hour ago, so I assume there‚Äôs nothing to update yet.</p>
<p>This is analogous to <code>brew update</code>, if I recall correctly: it refreshes the local cache of what packages are available. Meanwhile <code>nix-env -u</code> (or <code>nix-env --upgrade</code>) is analogous to <code>brew upgrade</code>.</p>
<p>For fun, I run:</p>
<pre tabindex=0><code>$ nix-env --install hello
installing 'hello-2.10'
$ nix-env --upgrade '*'
upgrading 'nss-cacert-3.49.2' to 'nss-cacert-3.60'
these paths will be fetched (0.22 MiB download, 0.41 MiB unpacked):
  /nix/store/b7ykp2bibwrhgf67ql9dq1yfyy8a8h3a-nss-cacert-3.60-unbundled
  /nix/store/ki7gssifc0xracrah8ygm63xj23wkjdz-nss-cacert-3.60
copying path '/nix/store/ki7gssifc0xracrah8ygm63xj23wkjdz-nss-cacert-3.60' from 'https://cache.nixos.org'...
copying path '/nix/store/b7ykp2bibwrhgf67ql9dq1yfyy8a8h3a-nss-cacert-3.60-unbundled' from 'https://cache.nixos.org'...
building '/nix/store/gmh97cqlq90cn7j7jsacsaaram1g7pxf-user-environment.drv'...
created 40 symlinks in user environment
</code></pre><p>Each of those commands still takes 30 seconds every time.</p>
<p>Impressively, I did have something to upgrade, even in so short a time. So I got to see that the command did, in fact, work. I now suspect that the ‚Äúcreated 40 symlinks in user environment‚Äù is like‚Ä¶ the total number? Not 40 <em>new</em> symlinks, but it‚Äôs like building a whole new user environment every time?</p>
<p>Let‚Äôs find out: the next example command is a rollback.</p>
<pre><code>$ nix-env --rollback
switching from generation 6 to 5
</code></pre>
<p>That happened <em>instantly</em>. How? What did it actually do? How did it know what to restore? Is anything actually different? Let‚Äôs find out.</p>
<pre><code>$ nix-env --upgrade --dry-run '*'
(dry run; not doing anything)
upgrading 'nss-cacert-3.49.2' to 'nss-cacert-3.60'
</code></pre>
<p>30 seconds later‚Ä¶ alright! Okay. So that worked.</p>
<p>I wonder how a numbered generation works if I do something now ‚Äì would that put me on generation 7? Or overwrite generation 6? Can I undo a rollback?</p>
<p>Let‚Äôs find out.</p>
<pre tabindex=0><code>$ nix-env --uninstall hello
uninstalling 'hello-2.10'
$ nix-env --list-generations
   1   2021-02-20 11:00:07
   2   2021-02-20 11:00:07
   3   2021-02-20 12:44:56
   4   2021-02-20 12:51:54
   5   2021-02-20 13:32:32
   6   2021-02-20 13:33:58
   7   2021-02-20 13:39:57   (current)
$ nix-env --switch-generation 6
switching from generation 7 to 6
$ nix-env --upgrade --dry-run '*'
(dry run; not doing anything)
$ hello
Hello, world!
</code></pre><p>Cool! Okay. Very cool. I got those commands from <code>man nix-env</code> under the <code>--rollback</code> command ‚Äì they are not listed in the quick start guide.</p>
<p>Lastly, we come to:</p>
<pre><code>$ nix-collect-garbage -d
</code></pre>
<p><code>-d</code> is short for <code>--delete-old</code>, which deletes packages that are no longer needed. Is the default garbage collection to‚Ä¶ keep packages that are no longer needed? I expect it will delete the old <code>nss-cacert-3.49.2</code> when I run it. Let‚Äôs find out.</p>
<p>Holy gosh. I‚Äôm not sure what all it printed because it blew out my scrollback printing so much. It ended with:</p>
<pre><code>1788 store paths deleted, 700.10 MiB freed
</code></pre>
<p>Wow. That‚Äôs quite a lot of garbage. Considering, you know, I just got here. I just installed <code>hello</code>. I don‚Äôt know what all that mess is. I certainly didn‚Äôt put it there.</p>
<p>I suspect that it was all the stuff that was installed when I ran <code>nix-shell -p hello</code>, so I run that again. And yep, sure enough, now it has to re-download all‚Ä¶ whatever it was that it downloaded. So that‚Äôs‚Ä¶ annoying. That doesn‚Äôt really seem like garbage to me, if I have to re-download it every time I want to use <code>nix-shell</code>.</p>
<p>And just for good measure: no, there is no nice <code>nix gc</code> version of this command.</p>
<h2 id=early-impressions>Early impressions</h2>
<p>That‚Äôs the end of the quick start guide. I learned a lot. I started. Not particularly quickly.</p>
<p>My main takeaway from this experience? <code>nix-env</code> invocations are too slow for anyone to reasonably use Nix as a package manager. Full stop. Every. Single. Command. 30 seconds. It was unbearable. I mean, it was nice for writing this blog post ‚Äì plenty of time to get my thoughts down ‚Äì but if I were an actual, normal user? Trying to <em>use</em> Nix? I would just stop. My Nix adventure would end before I finished running the first command. Because I would assume it was broken, <code>ctrl-C</code> outta there, and go back to using Homebrew (or pacman, or apt, or whatever).</p>
<p>I don‚Äôt remember this being such a huge issue before. I <em>do</em> remember using <code>nox</code> to actually manage packages ‚Äì it offered a fuzzy search a little bit like <code>nix search</code>, and it provided a better interface for installing stuff. But I don‚Äôt remember it taking <em>30 seconds to do anything</em>. Did I just block this out? Did I use <code>nox</code> for so long that I just never had to experience the joy of running bare <code>nix-env</code> commands? That‚Äôs crazy. This is Nix 2 land, the land of making things better. <em>Surely</em> we aren‚Äôt still supposed to use <code>nox</code>? Right? That would be crazy, right?</p>
<p>To test if this is some weird problem with my multi-volume setup in macOS, I got on my NixOS box and ran <code>time nix-env -i hello</code>. If it finishes before I publish this blog post, I‚Äôll let you know.</p>
<p>Oh, there it goes:</p>
<pre><code>42.03s user 22.34s system 26% cpu 3:58.80 total
</code></pre>
<p>Four minutes. Super.</p>
<p>Look, this is truly insane, and at this point I was actually mystified at how Nix is even a thing. But I‚Äôm writing here to say: it gets better. There‚Äôs a better way. We just have to get <em>slightly</em> outside of the quick start guide to see it.</p>
<h1 id=chapter-8-upgrading-nixhttpswebarchiveorgweb20210227145624httpsnixosorgmanualnixstablech-upgrading-nix><a href=https://web.archive.org/web/20210227145624/https://nixos.org/manual/nix/stable/#ch-upgrading-nix>Chapter 8. Upgrading Nix</a></h1>
<p>Yes, we went from chapter 3 to chapter 8. It‚Äôs not actually a big jump: chapters 4-6 are about installation; I already read the salient bits. Chapter 7 is about environment variables, but doesn‚Äôt really explain anything about them, just tells you what to set to get things working ‚Äì things that the install script already did.</p>
<p>Chapter 8 is about upgrading Nix, and it is two sentences long. One sentence is about single-user installs, and the other is about multi-user installs.</p>
<p>I did a single-user install, so to me upgrading looks like this:</p>
<pre><code>nix-env -iA nixpkgs.nix
</code></pre>
<p>And that blew the case wide open.</p>
<p>It‚Äôs a little weird: it uses a qualified path, which the quick start guide didn‚Äôt. It‚Äôs weird that it‚Äôs an install, not an upgrade ‚Äì I would have expected just <code>nix-env -u nix</code>. If <code>--install</code> performs an upgrade, why is there a separate <code>--upgrade</code>? Could <code>nix-env</code> drop that, and free up <code>-u</code> for <code>--uninstall</code>? I‚Äôm still not over <code>nix-env -e</code>.</p>
<p>Anyway, I read <code>man nix-env</code> to see what the <code>-A</code> means.</p>
<blockquote>
<p>If <code>--attr</code> (<code>-A</code>) is specified, the arguments are attribute paths that select attributes from the top-level Nix expression. This is faster than using derivation names and unambiguous.</p>
</blockquote>
<p>Faster? Faster, you say?</p>
<pre><code>$ nix-env -iA nixpkgs.nix
replacing old 'nix-2.3.10'
installing 'nix-2.3.10'
</code></pre>
<p>Wow! Basically instant, in fact. No 30 second sleep. It just <em>did stuff</em>.</p>
<p>But this made me wonder: are there ‚Äúfast‚Äù ways to install regular packages? Or is this some special thing about upgrading <code>nix</code>?</p>
<p>For science, I timed what I‚Äôve been dealing with this whole time:</p>
<pre><code>$ time nix-env --install hello
installing 'hello-2.10'
nix-env --install hello  14.08s user 5.51s system 60% cpu 32.211 total
</code></pre>
<p>My 30 second guesstimates have actually been pretty close. Nice.</p>
<p>And what about‚Ä¶</p>
<pre><code>$ time nix-env -iA nixpkgs.hello
installing 'hello-2.10'
nix-env -iA nixpkgs.hello  0.42s user 0.10s system 69% cpu 0.759 total
</code></pre>
<p><em>What?</em> Are you kidding me? Why ‚Äì why is the other thing even a thing? Why are there two ways to install packages, when one of them is <em>short but terrible</em> and one of them is <em>slightly more to type but usable?</em> Why isn‚Äôt there a <em>short and usable</em> command? And isn‚Äôt that what the <code>nix</code> tool is supposed to be? Where is it in all of this? Is it complicit??</p>
<p>I‚Äôm sure there is some complicated reason for all of this ‚Äì that without saying <code>nixpkgs.hello</code> it needs to like evaluate every single package in the entire package store ‚Äì all 32,544 of them ‚Äì and then do a linear scan for one called <code>hello</code>, or something ridiculous like that. Because <em>how could it possibly guess</em> that by <code>hello</code> I might mean <code>nixpkgs.hello</code>. But by using <code>-A</code>/<code>--attr</code>, it can just go to the right one? (???)</p>
<p>This is crazy. This is exactly the sort of thing that <em>seems crazy to me</em>, as a new user, but that I‚Äôm sure has some perfectly reasonable explanation to the Nix maintainers or power users who actually understand how <code>nix-env</code> works. ‚Äú<em>Of course</em> you need to specify <code>-A</code>,‚Äù I can hear them saying. ‚ÄúWhy would you ever use <code>nix-env -i</code> <em>without</em> <code>-A</code>?‚Äù</p>
<p>I am not being generous; I have no idea what the Nix community is actually like. I don‚Äôt think that I‚Äôve ever been on the Nix IRC or Discord or mailing list or whatever; I‚Äôm sure they‚Äôre perfectly nice and would very patiently explain to me why things are the way that they are without judging me or making me feel inadequate for my lack of experience.</p>
<p>But.</p>
<p>I think I can say, just, like, as an objective truth: the quick start guide should not use the 30 second versions of these commands. It should use the instant versions. That‚Äôs just a bug in the documentation.</p>
<p>Maybe there wasn‚Äôt much of a difference between the two versions, back when the manual was written. Maybe the 30 second commands were 1 second commands, and the relative simplicity of <code>nix-env -i hello</code> versus <code>nix-env -iA nixpkgs.hello</code> outweighed that small delay. Maybe it got slower over time, and no one thought to update the guide.</p>
<p>I can definitely sympathize. Documentation is hard; that‚Äôs why I‚Äôm publishing this.</p>
<p>Anyway, I‚Äôm glad I kept reading before I gave up completely.</p>
<hr>
<p>New open questions:</p>
<ul>
<li>How do I configure the location of the Nix binary cache (or other ‚Äúsubstituters,‚Äù if I recall the terminology correctly)?</li>
<li>What/why is <code>nix-shell '&lt;nixpkgs&gt;' --attr pan</code>?</li>
<li>What is <code>NIX_PATH</code>?</li>
<li>What does the weird comment mean about ‚Äúappending channels‚Äù to <code>NIX_PATH</code>?</li>
<li>What is <code>~/.nix-defexpr</code>?</li>
<li>What is <code>~/.nix-profile</code>?</li>
<li>What is <code>~/.nix-channels</code>?</li>
<li>What is <code>NIX_PROFILES</code>?</li>
<li>Why does <code>nix-env -qa git</code> print the same line three times?</li>
<li>Why doesn‚Äôt <code>nix-env -qa</code> behave like a search?</li>
<li>How do I search for packages by name using <code>nix-env</code>?</li>
<li>Why is there no <code>man nix</code>?</li>
<li>Why did <code>nix-env -i hello</code> tell me it ‚Äúcreated 40 symlinks in user environment‚Äù?</li>
<li>How do I install commands using <code>nix</code> instead of <code>nix-env</code>?</li>
<li>Why does <code>nix-shell</code> download so many packages? What are they for?</li>
<li>Why does <code>nix run</code> need the <code>nixpkgs</code> qualifier when <code>nix-shell</code> doesn‚Äôt?</li>
<li>Why does every invocation of <code>nix-env</code> take 30 seconds before it does <em>anything?</em></li>
<li>How do I collect garbage without making my next invocation of <code>nix-shell -p hello</code> redownload all the stuff it needs to be a shell?</li>
<li>Why is there an <code>--upgrade</code> command if <code>--install</code> will upgrade packages?</li>
<li>Why does the manual explicitly call out upgrading Nix? Will it not be upgraded through ‚Äúnormal‚Äù means? Do I have to upgrade it separately?</li>
</ul>
<section class=footnotes role=doc-endnotes>
<hr>
<ol>
<li id=fn:1 role=doc-endnote>
<p>This is a case where my past Nix experience may have saved me a bit of time. A friend read this blog post and made the following very good point: ‚Äúsurrounding a word in angle brackets is canonically the way you describe a like variable substitution in example code.‚Äù Which is true! And potentially very confusing! The fact that it‚Äôs in quotes hopefully makes this interpretation less likely, but <em>maybe not</em> I don‚Äôt know. It didn‚Äôt happen to trip me up, but maybe it would have five years ago.&nbsp;<a href=#fnref:1 class=footnote-backref role=doc-backlink>‚Ü©Ô∏é</a></p>
</li>
</ol>
</section></div>
</article>
<div class=post-footer>
<a href="mailto:ianthehenry@gmail.com?subject=let%27s%20talk%20about%20%22Quick%20starts%2c%20full%20hearts%22&amp;body=First%20of%20all,%20I%20just%20wanted%20to%20say%20that%20I%20forgive%20you%20for%20not%20having%20a%20real%20comment%20system%20on%20your%20site.">comment on this post</a><a href=https://ianthehenry.com/posts/how-to-learn-nix/basic-package-management/>Next up ‚ûú Basic package management</a></div>
<aside class=series-rider>
<p>
This post is part of the series <a class=series-name href=https://ianthehenry.com/posts/how-to-learn-nix/>How to Learn Nix</a>.
You can
<a target=_blank href=https://ianthehenry.com/feed.xml>subscribe to my RSS feed</a>
or
<a target=_blank href=https://twitter.com/ianthehenry>follow me on Twitter</a>
for more, or <a href=https://ianthehenry.com/posts/>peruse my back catalog</a> if you're in the mood for something different.
<div class=subsection-header>Opening remarks</div><ol start=1 class=post-list><li><a href=https://ianthehenry.com/posts/how-to-learn-nix/introduction/>What's all this about?</a></li>
<li><a href=https://ianthehenry.com/posts/how-to-learn-nix/prior-knowledge/>Prior knowledge</a></li>
</ol><div class=subsection-header>Reading the Nix manual</div><ol start=3 class=post-list><li><a href=https://ianthehenry.com/posts/how-to-learn-nix/glossary/>What we talk about when we talk about Nix</a></li>
<li><strong><a href=https://ianthehenry.com/posts/how-to-learn-nix/quick-start-guide/>Quick starts, full hearts</a></strong>&nbsp;‚Üê&nbsp;you are here</li>
<li><a href=https://ianthehenry.com/posts/how-to-learn-nix/basic-package-management/>Basic package management</a></li>
<li><a href=https://ianthehenry.com/posts/how-to-learn-nix/profiles/>Profiles</a></li>
<li><a href=https://ianthehenry.com/posts/how-to-learn-nix/garbage-collection/>Garbage collection</a></li>
<li><a href=https://ianthehenry.com/posts/how-to-learn-nix/channels/>Channels</a></li>
<li><a href=https://ianthehenry.com/posts/how-to-learn-nix/sharing/>Learning to share</a></li>
<li><a href=https://ianthehenry.com/posts/how-to-learn-nix/my-first-derivation/>My first derivation</a></li>
<li><a href=https://ianthehenry.com/posts/how-to-learn-nix/okay-my-actual-first-derivation/>Okay my actual first derivation</a></li>
<li><a href=https://ianthehenry.com/posts/how-to-learn-nix/nix-language/>The Nix expression language</a></li>
<li><a href=https://ianthehenry.com/posts/how-to-learn-nix/derivations/>Derivations</a></li>
<li><a href=https://ianthehenry.com/posts/how-to-learn-nix/built-in-functions/>Built-in Functions</a></li>
<li><a href=https://ianthehenry.com/posts/how-to-learn-nix/advanced-topics/>Advanced Topics</a></li>
<li><a href=https://ianthehenry.com/posts/how-to-learn-nix/command-reference/>Command Reference</a></li>
<li><a href=https://ianthehenry.com/posts/how-to-learn-nix/configuration/>Configuration</a></li>
</ol><div class=subsection-header>Interlude: in which we follow our hearts, however briefly</div><ol start=18 class=post-list><li><a href=https://ianthehenry.com/posts/how-to-learn-nix/nix-manual-reflection/>So I read the manual huh</a></li>
<li><a href=https://ianthehenry.com/posts/how-to-learn-nix/switching-from-homebrew-to-nix/>Switching from Homebrew to Nix</a></li>
<li><a href=https://ianthehenry.com/posts/how-to-learn-nix/my-first-nix-bug/>My first Nix bug</a></li>
<li><a href=https://ianthehenry.com/posts/how-to-learn-nix/my-first-package-upgrade/>My first package upgrade</a></li>
<li><a href=https://ianthehenry.com/posts/how-to-learn-nix/declarative-user-environment/>Setting up a declarative user environment</a></li>
</ol><div class=subsection-header>Reading the Nixpkgs manual</div><ol start=23 class=post-list><li><a href=https://ianthehenry.com/posts/how-to-learn-nix/how-to-learn-nixpkgs/>How to learn Nixpkgs</a></li>
<li><a href=https://ianthehenry.com/posts/how-to-learn-nix/overlays/>Overlays</a></li>
<li><a href=https://ianthehenry.com/posts/how-to-learn-nix/overriding/>Overriding</a></li>
<li><a href=https://ianthehenry.com/posts/how-to-learn-nix/an-infinite-list-of-functions/>An infinite list of functions</a></li>
<li><a href=https://ianthehenry.com/posts/how-to-learn-nix/even-more-functions-somehow/>Even more functions, somehow</a></li>
<li><a href=https://ianthehenry.com/posts/how-to-learn-nix/the-standard-environment/>The standard environment</a></li>
<li><a href=https://ianthehenry.com/posts/how-to-learn-nix/derivations-in-detail/>Derivations in detail</a></li>
<li><a href=https://ianthehenry.com/posts/how-to-learn-nix/cross-compilation/>Cross-compilation</a></li>
<li><a href=https://ianthehenry.com/posts/how-to-learn-nix/platform-notes/>Platform notes</a></li>
<li><a href=https://ianthehenry.com/posts/how-to-learn-nix/builders/>Builders</a></li>
<li><a href=https://ianthehenry.com/posts/how-to-learn-nix/languages-and-frameworks/>Languages and frameworks</a></li>
<li><a href=https://ianthehenry.com/posts/how-to-learn-nix/random-package-grab-bag/>Random package grab-bag</a></li>
<li><a href=https://ianthehenry.com/posts/how-to-learn-nix/how-to-give-back/>How to give back</a></li>
</ol><div class=subsection-header>Documentation behind us, we set out on our own</div><ol start=36 class=post-list><li><a href=https://ianthehenry.com/posts/how-to-learn-nix/nixpkgs-reflection/>So I read the other manual, huh</a></li>
<li><a href=https://ianthehenry.com/posts/how-to-learn-nix/saving-your-shell/>Saving your shell</a></li>
</ol><div class=subsection-header>Oh right forgot about Nix Pills</div><ol start=38 class=post-list><li><a href=https://ianthehenry.com/posts/how-to-learn-nix/nix-pills/>Nix Pills</a></li>
</ol><div class=subsection-header>Our whole lives ahead of us</div><ol start=39 class=post-list><li><a href=https://ianthehenry.com/posts/how-to-learn-nix/python3-alpha/>How to install Python</a></li>
<li><a href=https://ianthehenry.com/posts/how-to-learn-nix/open-questions/>Open questions</a></li>
<li><a href=https://ianthehenry.com/posts/how-to-learn-nix/ambiguous-packages/>Ambiguous packages</a></li>
<li><a href=https://ianthehenry.com/posts/how-to-learn-nix/nix-zshell/>Running zsh in nix-shell</a></li>
</ol><div class=subsection-header>Nix 2.4 slithers to life</div><ol start=43 class=post-list><li><a href=https://ianthehenry.com/posts/how-to-learn-nix/flakes/>My first brush with flakes</a></li>
<li><a href=https://ianthehenry.com/posts/how-to-learn-nix/more-flakes/>More flakes, unfortunately</a></li>
<li><a href=https://ianthehenry.com/posts/how-to-learn-nix/new-profiles/>Fancy new profiles</a></li>
<li><a href=https://ianthehenry.com/posts/how-to-learn-nix/chipping-away-at-flakes/>Chipping away at flakes</a></li>
<li><a href=https://ianthehenry.com/posts/how-to-learn-nix/nix-develop/>New and unimproved shells</a></li>
</ol>
</aside>
</main>
<footer>
¬© 1899-1907 <a href=https://ianthehenry.com/about/>Ian Henry</a>
</footer>
