<!DOCTYPE html> <html lang=en style><!--
 Page saved with SingleFile 
 url: https://ianthehenry.com/posts/how-to-learn-nix/even-more-functions-somehow/ 
 saved date: Mon Jul 17 2023 13:35:12 GMT+0600 (Kyrgyzstan Time)
--><meta charset=utf-8>
<meta name=viewport content="initial-scale=1,maximum-scale=1">
<title>How to Learn Nix, Part 27: Even more functions, somehow</title>
<link rel=canonical href=https://ianthehenry.com/posts/how-to-learn-nix/even-more-functions-somehow/>
<style>:root{--box-radius:6px;--outer-box-radius:10px}:root{--content-bg:#fff;--gutter-bg:#eeeef3;--text-fg:#4d4d4c;--table-border-color:#ccc;--separator-color:#6d6d6c;--link:#07c;--link-visited:#751a9a;--blockquote-accent:var(--link);--footnote-accent:#ffd2a3;--subscribe-button-bg:#44e66c;--subscribe-button-fg:#11391b;--media-controls-on:#34b553;--media-controls-contrast:#fff;--inline-code-bg:#f3f3fa;--code-block-bg:#f3f3fa;--aside-bg:#f3f3fa;--aside-warning-bg:#fff5d1;--aside-warning-fg:#ac3233;--palette-red:#c82829;--palette-green:#718c00;--palette-yellow:#eab700;--palette-orange:#f5871f;--palette-blue:#4271ae;--palette-purple:#8959a8;--palette-teal:#3e999f;--palette-white:#fefefe;--palette-black:#000;--palette-text:var(--text-fg);--palette-dim:#8e908c;--highlight-bg:var(--palette-yellow);--highlight-fg:var(--text-fg)}#dmt::before{content:"üåñ"}#dmt:hover::before{content:"üåó"}@media (prefers-color-scheme:dark){:root:not(.light-theme){--content-bg:#313233;--gutter-bg:#1d1f21;--text-fg:#d8d4cf;--table-border-color:#ccc;--separator-color:#6d6d6c;--link:rgb(82,183,255);--link-visited:rgb(193,104,229);--blockquote-accent:var(--link);--footnote-accent:#a8612f;--subscribe-button-bg:#44e66c;--subscribe-button-fg:#11391b;--media-controls-on:#44e66c;--media-controls-contrast:#11391b;--inline-code-bg:#3c4044;--code-block-bg:#1d1f21;--aside-bg:#3c4044;--aside-warning-bg:#fff5d1;--aside-warning-fg:var(--palette-red);--palette-red:#cc6666;--palette-green:#b5bd68;--palette-yellow:#f0c674;--palette-orange:#de935f;--palette-blue:#81a2be;--palette-purple:#b294bb;--palette-teal:#8abeb7;--palette-white:#fefefe;--palette-black:#000;--palette-text:var(--text-fg);--palette-dim:#969896;--highlight-bg:var(--palette-yellow);--highlight-fg:var(--palette-black)}:root:not(.light-theme) #dmt::before{content:"üåí"}:root:not(.light-theme) #dmt:hover::before{content:"üåì"}}#dmt{width:30px;text-align:right;padding-right:4px;position:absolute;top:0;bottom:0;right:0;border:none;background-color:inherit;cursor:pointer}*{margin:0;padding:0;font:inherit;box-sizing:border-box}html{background-color:var(--gutter-bg);color:var(--text-fg)}body{font-family:system-ui,sans-serif;font-size:12pt;line-height:1.8;word-wrap:break-word}body:not(.content-page) main>aside{padding:0 var(--content-padding)}body.content-page main,body:not(.content-page) article{background-color:var(--content-bg);border-radius:var(--outer-box-radius);padding:var(--content-padding)}pre{word-wrap:normal}em,i{font-style:italic}h1>a:only-child,h2>a:only-child{display:block}main .subsection-header+.post-list{margin-top:0}strong{font-weight:700}ol,ul{padding-left:3ch}hr{border-style:solid;border-width:1.5px 0 0;border-radius:1px;border-color:var(--separator-color)}:not(pre)>code{white-space:pre;background-color:var(--inline-code-bg)}li{padding-left:0}blockquote{quotes:none}blockquote:before,blockquote:after,q:before,q:after{content:"";content:none}a,a:active,a:visited{text-decoration:none}a:hover{text-decoration:underline}blockquote{padding:0 0 0 var(--content-padding);border-left:solid 2px var(--blockquote-accent)}aside{--content-padding:0.5em;padding:.5em;border-radius:var(--box-radius);background-color:var(--aside-bg)}a,a:active,header a:visited,footer a:visited,h1 a:visited,h2 a:visited{color:var(--link)}a:visited{color:var(--link-visited)}h1{font-size:130%}h2{font-size:120%}main *+p,main *+pre,main *+aside,main *+article,main *+blockquote,main *+div,main *+ul,main *+hr,main *+h1,main *+h2{margin-top:1em}main pre+div.highlight{margin-top:1px}main .post-header *+h1{margin-top:0}code{font-family:Menlo,monospace;padding:0 3px;border-radius:2px}pre{background-color:var(--code-block-bg);font-size:11pt;padding:calc(.75*var(--content-padding)) var(--content-padding);line-height:1.3;border-radius:var(--box-radius);overflow-x:scroll;-webkit-overflow-scrolling:touch}pre code{padding:0;border-radius:0;display:inline-block;background-color:initial}p+p{margin-top:1em}body{margin:0 auto;--content-padding:10px;max-width:768px;-webkit-text-size-adjust:100%;position:relative}header{position:relative}header>*{height:48px;line-height:48px}.promo,.promo:visited,.promo:active{display:block;text-align:center;background-color:var(--link);color:var(--code-block-bg);border-radius:0 0 var(--outer-box-radius) var(--outer-box-radius)}header .site-title{font-size:130%}header nav{position:absolute;right:30px;top:0}@media all and (max-width:400px){:root{--outer-box-radius:0}header{text-align:center}header nav{position:static}:not(pre)>code{white-space:pre-wrap}body{--content-padding:10px}#dmt{padding:0;text-align:center;width:40px}}header ul{padding:0}header li{list-style:none;display:inline-block}header a{display:block;height:100%}header li+li{margin-left:1em}footer{padding:2em 0;font-size:.85em;text-align:center}article h1.post-title{font-size:200%}article .post-title a{display:block}article .meta{font-size:90%;font-style:italic}.post-header h1{line-height:1.2em;margin-bottom:.5em}.post-footer{text-align:center}.post-footer a{display:block}ol.post-list{list-style-position:inside;padding:0}.series-rider .series-name{font-style:italic}.highlight{color:var(--palette-text)}.highlight .err{color:var(--palette-red)}.highlight .k{color:var(--palette-purple)}.highlight .n{color:var(--palette-text)}.highlight .o{color:var(--palette-teal)}.highlight .p{color:var(--palette-text)}.highlight .cm{color:var(--palette-dim)}.highlight .c1{color:var(--palette-dim)}.highlight .nb{color:var(--palette-text)}.highlight .no{color:var(--palette-red)}.highlight .mi{color:var(--palette-orange)}.highlight .s2{color:var(--palette-green)}.highlight .se{color:var(--palette-orange)}</style>
<meta property=og:title content="How to Learn Nix, Part 27: Even more functions, somehow">
<meta property=og:type content=website>
<meta property=og:url content=https://ianthehenry.com/posts/how-to-learn-nix/even-more-functions-somehow/>
<meta name=description content="Okay. We aren‚Äôt actually done with Chapter 5 yet. We got through the bulk of it, but we still have a few short sections to go.">
<meta property=og:description content="Okay. We aren‚Äôt actually done with Chapter 5 yet. We got through the bulk of it, but we still have a few short sections to go.">
<meta property=og:image content=https://ianthehenry.com/checkerboard.png>
<meta name=twitter:creator content=@ianthehenry>
<meta name=twitter:card content=summary>
<link type=image/x-icon rel="shortcut icon" href="data:image/vnd.microsoft.icon;base64,AAABAAEAEBAAAAEAIABoBAAAFgAAACgAAAAQAAAAIAAAAAEAIAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAHH1uIDShg/xEsZv8GFk3/CSJb/wgZT/8IGU//CBlP/wkiW/8HGE7/CBlP/wkiW/8HIFX/BxhO/wcgVf8OK2t7JDhz/wcfW/8NNn7/CSpq/wkjYf8MJGP/DCJg/w02ef9SqdX/TKHJ/1my2f9Moc3/UqzV/1Cr1v9Pocf/Ditr/xk2cf8KJGL/CjR8/wwva/8RK2r/Cido/w8qa/8LLW//TqjT/1Gnz/9bsNf/Sp/K/1Wt2f9Wrtj/UKjQ/w8xc/8gPHj/Di5w/xk4ef8TL27/Dy5u/xU3fv8QLGv/Ditr/1qy3f9dttv/Yrje/0ecx/9Knsz/U6fQ/1m13f8YN3n/JjZx/wszdv8YOXz/Eilm/xc3e/8dSZT/GDJz/xk/hv9hu+P/WbHZ/1mv1v9Kn8z/WLHd/1212v9ds9n/Eipr/xcqYv8SOX3/GzRz/xQrZ/8aM3D/HEuU/xc0df8fPYD/Yrre/1603P9dt9z/VKvY/1iz4v9etNr/Y73m/xk5fP8cMm3/JEWK/xc0dP8eO3v/Hjd4/ydRnP8WM3P/Gjd3/2bA5/9dtd//Ybng/2K95v9ct+P/Ybnf/2K95/8oS5L/GChg/xxBh/8lSIz/GC5s/yM5ev8hRoz/HTp7/yE6e/9Zsdz/YLzn/2jF7v9ryfL/YLzn/1qu1f9htdz/GDyD/y0/ev9qx/X/acDn/1235v9euun/Yb3r/1665v9owu7/GUOL/yhGh/8nUJL/MkmI/yBFiP8jOHb/MVag/yM+gv8VMGv/acXx/27G7/9szv3/bMb1/2zD6/9vy/X/edf5/yBHjv8yS47/JEuO/zVLiv8nS5D/LkOB/yRXpP8lQoT/H0WI/3fS+P910Pf/b8/8/2bB7/991Pn/eNb+/3nT+P8pS5L/O1GS/ytUnP86UJH/NF2k/zNLjP8sXKv/JkCB/x4+ff+B2/3/etT9/4He//922f//fNf//3TT//991/7/NU6N/zZSkP86Zav/PlWR/zFepv88ZKb/MF2n/yQ/gf8bNXH/fd3//3/b//+K6P//ft///3vV//993f//gdz//0hWlf9FZKX/RmOj/0JXlv9IeMP/QXKz/0Jsuf8eO3z/Hjt2/3vd//+C3v//ju3//3zg//+H4v//guL//4nj//9HXp3/UGur/ztgqf9JYqP/S3G4/05ur/9EbLT/Hjt7/zNJhf+G4///heT//4rq//+E5///iOT//4jr//+G4///UXO0/09iov9EX6H/SWWn/1V5wP9Kaa7/RGSp/ydLj/8NKGCfDShg/x8+d/8RLGb/CBlP/wYWTf8GFEj/CBNH/wooZP8JIlv/CCJd/woWSf8HGE7/ByBV/wwgU/8fO3mfAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA=="><meta http-equiv=content-security-policy content="default-src 'none'; font-src 'self' data:; img-src 'self' data:; style-src 'unsafe-inline'; media-src 'self' data:; script-src 'unsafe-inline' data:; object-src 'self' data:; frame-src 'self' data:;"><style>img[src="data:,"],source[src="data:,"]{display:none!important}</style></head>
<body class=content-page>
<a class=promo href=https://janet.guide/ target=_blank><i>psst, hey kid, wanna read a weird programming book</i></a>
<header>
<a class=site-title href=https://ianthehenry.com/>Ian Henry</a>
<nav>
<ul><li><a href=https://ianthehenry.com/about/>About</a><li><a href=https://ianthehenry.com/posts/>Blog</a><li><a href=https://ianthehenry.com/stuff/>Stuff</a></ul>
</nav>
<button id=dmt title="Toggle dark mode"></button>
</header>
<main>
<aside class=series-rider>
<p>This post is part of the series <a class=series-name href=https://ianthehenry.com/posts/how-to-learn-nix/>How to Learn Nix</a>, a rambling diary in which I work my way through the Nix manual in excrutiating detail.</p>
</aside>
<article class=post>
<div class=post-header>
<time class=meta datetime=2021-04-12>April 12, 2021</time>
<h1 class=post-title>
<a href=https://ianthehenry.com/posts/how-to-learn-nix/even-more-functions-somehow/>How to Learn Nix, Part&nbsp;27:<br>Even more functions, somehow</a></h1>
</div>
<div class=post-content><p>Okay. We aren‚Äôt actually done with Chapter 5 yet. We got through the bulk of it, but we still have a few short sections to go.</p>
<h2 id=52-generatorshttpswebarchiveorgweb20210318102415if_httpsnixosorgmanualnixpkgsstablesec-generators><a href=https://web.archive.org/web/20210318102415if_/https://nixos.org/manual/nixpkgs/stable/#sec-generators>5.2. Generators</a></h2>
<blockquote>
<p>Generators are functions that create file formats from nix data structures, e.‚ÄØg. for configuration files. There are generators available for: <code>INI</code>, <code>JSON</code> and <code>YAML</code></p>
</blockquote>
<p>Well, as a matter of fact, looking at <code>lib.generators</code>, it seems that there are generators for:</p>
<pre><code>toGitINI
toINI
toJSON
toKeyValue
toPlist
toPretty
toYAML
</code></pre>
<p>Some of those are self-explanatory‚Ä¶ but not all of them. What is <code>GitINI</code>? I have to turn to the source:</p>
<blockquote>
<div class=highlight><pre tabindex=0 class=chroma><code class=language-nix data-lang=nix><span class=cm>/*
</span><span class=cm> * Generate a git-config file from an attrset.
</span><span class=cm> *
</span><span class=cm> * It has two major differences from the regular INI format:
</span><span class=cm> *
</span><span class=cm> * 1. values are indented with tabs
</span><span class=cm> * 2. sections can have sub-sections
</span></code></pre></div></blockquote>
<p>Okay, sure.</p>
<p>I don‚Äôt really know what a ‚Äúkey-value‚Äù is either. I guess <code>=</code> separated? Or it‚Äôs configurable? I dunno. Doesn‚Äôt matter.</p>
<p>What is <code>toPretty</code>?</p>
<blockquote>
<pre tabindex=0><code>/* Pretty print a value, akin to `builtins.trace`.
  * Should probably be a builtin as well.
  */
</code></pre></blockquote>
<p>A lot of these functions have those weird misaligned asterisks. But who cares? We got pretty-printing! Can it work??</p>
<pre tabindex=0><code>nix-repl&gt; lib.generators.toPretty { x = 1; }
error: 'toPretty' at /nix/store/mi0xpwzl81c7dgpr09qd67knbc24xab5-nixpkgs-21.05pre274251.f5f6dc053b1/nixpkgs/lib/generators.nix:202:14
called with unexpected argument 'x', at (string):1:1
</code></pre><p>Umm okay hmm. The documentation doesn‚Äôt say anything about‚Ä¶ how to actually use this function. But reading the source, it seems‚Ä¶</p>
<pre tabindex=0><code>nix-repl&gt; lib.generators.toPretty { multiline = true; } { x = 1; }
"{\n  x = 1;\n}"
</code></pre><p><em>So close</em>. It, you know, it did pretty print the value, I guess. In a way that is completely useless to me.</p>
<p>Sigh. So‚Ä¶ still searching, then.</p>
<p>Returning to the manual:</p>
<blockquote>
<p>All generators follow a similar call interface: <code>generatorName configFunctions data</code>, where <code>configFunctions</code> is an attrset of user-defined functions that format nested parts of the content.</p>
</blockquote>
<p>Okay; it did immediately describe how to call generator functions.</p>
<p>Nothing super interesting here, and the section is over.</p>
<h2 id=53-debugging-nix-expressionshttpswebarchiveorgweb20210318102415if_httpsnixosorgmanualnixpkgsstablesec-debug><a href=https://web.archive.org/web/20210318102415if_/https://nixos.org/manual/nixpkgs/stable/#sec-debug>5.3. Debugging Nix Expressions</a></h2>
<p>This section just says ‚Äúthere are functions in <code>lib.debug</code> for debugging.‚Äù That‚Äôs not‚Ä¶ we already saw that. The manual already said that. This is not a useful section.</p>
<h2 id=54-prefer-remote-fetch-overlayhttpswebarchiveorgweb20210318102415if_httpsnixosorgmanualnixpkgsstablesec-prefer-remote-fetch><a href=https://web.archive.org/web/20210318102415if_/https://nixos.org/manual/nixpkgs/stable/#sec-prefer-remote-fetch>5.4. <code>prefer-remote-fetch</code> overlay</a></h2>
<blockquote>
<p><code>prefer-remote-fetch</code> is an overlay that download sources on remote builder. This is useful when the evaluating machine has a slow upload while the builder can fetch faster directly from the source. To use it, put the following snippet as a new overlay:</p>
<pre tabindex=0><code>self: super:
  (super.prefer-remote-fetch self super)
</code></pre></blockquote>
<p>Okay‚Ä¶ I haven‚Äôt actually used overlays yet, so I have to stop and remind myself how they work. So this overlay is a function that takes the entire Nixpkgs set, and returns a new Nixpkgs set. Right? Which means <code>prefer-remote-fetch</code> is the name of a function in the top-level of Nixpkgs that takes two arguments: the ‚Äúfinal‚Äù package set, and the ‚Äúcurrent‚Äù package set. In other words, there is an overlay-shaped function in the top-level Nixpkgs set.</p>
<p>Okay. So it looks kind of goofy, but the point-free equivalent would be much more hairy, so we just write it out. Fair enough.</p>
<p>And in fact yes; I remembered how this worked correctly:</p>
<pre tabindex=0><code>nix-repl&gt; pkgs.prefer-remote-fetch
¬´lambda @ /nix/store/mi0xpwzl81c7dgpr09qd67knbc24xab5-nixpkgs-21.05pre274251.f5f6dc053b1/nixpkgs/pkgs/build-support/prefer-remote-fetch/default.nix:13:1¬ª
</code></pre><p>I don‚Äôt think I‚Äôve seen a kebab-cased attribute before. I didn‚Äôt even realize that was a valid identifier. I love kebab-case. It‚Äôs a shame that Nix seems to use camelCase for everything else.</p>
<p>Okay, so I am curious how this works. I have not actually used a remote builder (yet), but this feels‚Ä¶ magic? Not in a good way? Like I have no idea how this would be implemented. Let‚Äôs take a peek.</p>
<pre><code>$ cat ~/src/nixpkgs/pkgs/build-support/prefer-remote-fetch/default.nix
</code></pre>
<div class=highlight><pre tabindex=0 class=chroma><code class=language-nix data-lang=nix><span class=c1># An overlay that download sources on remote builder.</span>
<span class=c1># This is useful when the evaluating machine has a slow</span>
<span class=c1># upload while the builder can fetch faster directly from the source.</span>
<span class=c1># Usage: Put the following snippet in your usual overlay definition:</span>
<span class=c1>#</span>
<span class=c1>#   self: super:</span>
<span class=c1>#     (super.prefer-remote-fetch self super)</span>
<span class=c1># Full configuration example for your own account:</span>
<span class=c1>#</span>
<span class=c1># $ mkdir ~/.config/nixpkgs/overlays/</span>
<span class=c1># $ echo 'self: super: super.prefer-remote-fetch self super' &gt; ~/.config/nixpkgs/overlays/prefer-remote-fetch.nix</span>
<span class=c1>#</span>
<span class=n>self</span><span class=p>:</span> <span class=n>super</span><span class=p>:</span> <span class=p>{</span>
  <span class=n>fetchurl</span> <span class=o>=</span> <span class=n>args</span><span class=p>:</span> <span class=n>super</span><span class=o>.</span><span class=n>fetchurl</span> <span class=p>(</span><span class=n>args</span> <span class=o>//</span> <span class=p>{</span> <span class=n>preferLocalBuild</span> <span class=o>=</span> <span class=no>false</span><span class=p>;</span> <span class=p>});</span>
  <span class=n>fetchgit</span> <span class=o>=</span> <span class=n>args</span><span class=p>:</span> <span class=n>super</span><span class=o>.</span><span class=n>fetchgit</span> <span class=p>(</span><span class=n>args</span> <span class=o>//</span> <span class=p>{</span> <span class=n>preferLocalBuild</span> <span class=o>=</span> <span class=no>false</span><span class=p>;</span> <span class=p>});</span>
  <span class=n>fetchhg</span> <span class=o>=</span> <span class=n>args</span><span class=p>:</span> <span class=n>super</span><span class=o>.</span><span class=n>fetchhg</span> <span class=p>(</span><span class=n>args</span> <span class=o>//</span> <span class=p>{</span> <span class=n>preferLocalBuild</span> <span class=o>=</span> <span class=no>false</span><span class=p>;</span> <span class=p>});</span>
  <span class=n>fetchsvn</span> <span class=o>=</span> <span class=n>args</span><span class=p>:</span> <span class=n>super</span><span class=o>.</span><span class=n>fetchsvn</span> <span class=p>(</span><span class=n>args</span> <span class=o>//</span> <span class=p>{</span> <span class=n>preferLocalBuild</span> <span class=o>=</span> <span class=no>false</span><span class=p>;</span> <span class=p>});</span>
  <span class=n>fetchipfs</span> <span class=o>=</span> <span class=n>args</span><span class=p>:</span> <span class=n>super</span><span class=o>.</span><span class=n>fetchipfs</span> <span class=p>(</span><span class=n>args</span> <span class=o>//</span> <span class=p>{</span> <span class=n>preferLocalBuild</span> <span class=o>=</span> <span class=no>false</span><span class=p>;</span> <span class=p>});</span>
<span class=p>}</span>
</code></pre></div><p>Aha. So it just monkeypatches all the <code>fetch*</code> functions to insist <code>preferLocalBuild = false</code>. Okay. Not so magic, then.</p>
<p>I used to write a bunch of Objective-C code, and in Objective-C monkeypatching is called <em>swizzling</em>, which is a much more whimsical term and I wish it had become standardized but here we are.</p>
<p>I realize that we‚Äôre just modifying a set here and these are <em>functions</em> not <em>methods</em> so neither term actually applies but whatever you get what I‚Äôm saying.</p>
<p>Short section.</p>
<h2 id=55-pkgsnix-gitignorehttpswebarchiveorgweb20210318102415if_httpsnixosorgmanualnixpkgsstablesec-pkgs-nix-gitignore><a href=https://web.archive.org/web/20210318102415if_/https://nixos.org/manual/nixpkgs/stable/#sec-pkgs-nix-gitignore>5.5. <code>pkgs.nix-gitignore</code></a></h2>
<blockquote>
<p><code>pkgs.nix-gitignore</code> is a function that acts similarly to <code>builtins.filterSource</code> but also allows filtering with the help of the gitignore format.</p>
</blockquote>
<p>More kebab-case!</p>
<p>There are two subsections here that describe how to use it.</p>
<p>The intro said ‚Äì and I am quoting ‚Äì ‚Äú<code>pkgs.nix-gitignore</code> is a function,‚Äù but it seems that it‚Äôs <em>not</em>, it‚Äôs a set that <em>contains</em> a bunch of functions.</p>
<p>Okay. Seems useful, for, you know, packaging stuff.</p>
<p>Nothing for <code>hgignore</code>! But since we still can‚Äôt actually <em>install Mercurial</em> with Nix I am not surprised by that. No idea when or if 2.3.11 is ever going to come out.</p>
<h1 id=okay-we-really-did-it-this-time>okay we really did it this time</h1>
<p>That‚Äôs the end! We read Chapter 5.</p>
<p>But‚Ä¶ there are still a lot more functions that we didn‚Äôt talk about.</p>
<p>Like, if I just look at <code>lib</code>, and filter all its values just for the sets, and exclude the ones we‚Äôve already talked about‚Ä¶</p>
<pre><code>cli = { ... };
customisation = { ... };
fetchers = { ... };
filesystem = { ... };
fixedPoints = { ... };
kernel = { ... };
licenses = { ... };
maintainers = { ... };
mergeAttrBy = { ... };
meta = { ... };
misc = { ... };
modules = { ... };
platforms = { ... };
</code></pre>
<p>There are more! There are a lot more.</p>
<p>Of course, not all of those are actually function namespaces. <code>licenses</code>, <code>maintainers</code>, <code>platforms</code>, etc‚Ä¶ these are just collections of values. <code>mergeAttrBy</code> seems to be a cutesy sort of collection of specific merge functions? What is this?</p>
<p>Ah, okay ‚Äì there‚Äôs a function <code>mergeAttrByFunc</code> which allows you to merge two sets by calling a specific function for each attribute. So if I‚Äôm reading this right:</p>
<pre tabindex=0><code>nix-repl&gt; myMerge = lib.mergeAttrByFunc {
            small = lib.trivial.min;
            large = lib.trivial.max;
          }

nix-repl&gt; myMerge { small = 10; large = 10; }
                  { small = 20; large = 20; }
error: attempt to call something which is not a function but a set, at (string):1:1
</code></pre><p>Okay, no; it‚Äôs a <em>much weirder API</em>:</p>
<pre tabindex=0><code>nix-repl&gt; lib.mergeAttrByFunc {
            mergeAttrBy = {
              small = lib.trivial.min;
              large = lib.trivial.max;
            };
            small = 10;
            large = 10;
          }
          { small = 20; large = 20; }
{ large = 20; mergeAttrBy = { ... }; small = 10; }
</code></pre><p>That‚Äôs just‚Ä¶ <em>why is it intrusive like that</em>. That‚Äôs so <em>gross</em>. Anyway <code>mergeAttrBy</code> is a function of the <code>mergeAttrBy</code> <em>shape</em> that provides sane default merge values for derivation attributes ‚Äì concatenates the <code>buildInputs</code>, tries to concatenate the shell scripts as strings ‚Äì although I feel like there might be some weird edge case here; I don‚Äôt know if you can just conjoin two lines of shell like that safely in all cases. It‚Äôs shell. There‚Äôs gotta be a case where that‚Äôs not okay, right?</p>
<p>This is not important.</p>
<p>Anyway, these functions are defined in a file called <code>deprecated.nix</code>, so‚Ä¶ yeah. I dunno what the non-deprecated way to do this is.</p>
<p>Oh, look!</p>
<blockquote>
<div class=highlight><pre tabindex=0 class=chroma><code class=language-nix data-lang=nix> <span class=cm>/* deprecated:
</span><span class=cm>
</span><span class=cm>    For historical reasons, imap has an index starting at 1.
</span><span class=cm>
</span><span class=cm>    But for consistency with the rest of the library we want an index
</span><span class=cm>    starting at zero.
</span><span class=cm> */</span>
 <span class=n>imap</span> <span class=err>=</span> <span class=n>imap1</span><span class=p>;</span>
</code></pre></div></blockquote>
<p>Well that explains why Nix‚Äôs <code>imap</code> is explicitly called <code>imap0</code>. Huh!</p>
<p>But anyway, about a non-deprecated <code>mergeAttrByFunc</code>‚Ä¶ I dunno. It‚Äôs a pretty simple helper to define yourself. The fact that it doesn‚Äôt exist in <code>lib.attrsets</code> makes me think it is not really useful in practice. And <code>lib.attrsets.zipWithFunc</code> is a more general version (merges an arbitrary number of sets, not just two; merge function is determined by a function call instead of a set lookup). I dunno. Whatever. Question answered.</p>
<p>Which means all of these:</p>
<pre><code>cli = { ... };
customisation = { ... };
fetchers = { ... };
filesystem = { ... };
fixedPoints = { ... };
kernel = { ... };
meta = { ... };
misc = { ... };
modules = { ... };
</code></pre>
<p>Are <code>lib</code> function namespace-alikes that are not documented in the manual.</p>
<p>So‚Ä¶ let‚Äôs dive in, I guess.</p>
<p>The source actually seems really well commented, so I‚Äôm going to just start there.</p>
<p>Starting with <code>cli</code>, there are only two functions ‚Äì <code>toGNUCommandLine</code> and <code>toGNUCommandLineShell</code>. There‚Äôs an example in the source:</p>
<blockquote>
<div class=highlight><pre tabindex=0 class=chroma><code class=language-nix data-lang=nix><span class=n>cli</span><span class=o>.</span><span class=n>toGNUCommandLine</span> <span class=p>{}</span> <span class=p>{</span>
  <span class=n>data</span> <span class=o>=</span> <span class=nb>builtins</span><span class=o>.</span><span class=n>toJSON</span> <span class=p>{</span> <span class=n>id</span> <span class=o>=</span> <span class=mi>0</span><span class=p>;</span> <span class=p>};</span>
  <span class=n>X</span> <span class=o>=</span> <span class=s2>"PUT"</span><span class=p>;</span>
  <span class=n>retry</span> <span class=o>=</span> <span class=mi>3</span><span class=p>;</span>
  <span class=n>retry-delay</span> <span class=o>=</span> <span class=no>null</span><span class=p>;</span>
  <span class=n>url</span> <span class=o>=</span> <span class=p>[</span> <span class=s2>"https://example.com/foo"</span> <span class=s2>"https://example.com/bar"</span> <span class=p>];</span>
  <span class=n>silent</span> <span class=o>=</span> <span class=no>false</span><span class=p>;</span>
  <span class=n>verbose</span> <span class=o>=</span> <span class=no>true</span><span class=p>;</span>
<span class=p>}</span>
<span class=err>=</span><span class=o>&gt;</span> <span class=p>[</span>
  <span class=s2>"-X"</span> <span class=s2>"PUT"</span>
  <span class=s2>"--data"</span> <span class=s2>"{</span><span class=se>\"</span><span class=s2>id</span><span class=se>\"</span><span class=s2>:0}"</span>
  <span class=s2>"--retry"</span> <span class=s2>"3"</span>
  <span class=s2>"--url"</span> <span class=s2>"https://example.com/foo"</span>
  <span class=s2>"--url"</span> <span class=s2>"https://example.com/bar"</span>
  <span class=s2>"--verbose"</span>
<span class=p>]</span>
</code></pre></div></blockquote>
<p>And <code>toGNUCommandLineShell</code> just calls <code>lib.strings.escapeShellArgs</code> on the return value. Easy.</p>
<p><code>lib.customization</code> is the home of:</p>
<pre><code>callPackageWith
callPackagesWith
extendDerivation
hydraJob
makeOverridable
makeScope
makeScopeWithSplicing
overrideDerivation
</code></pre>
<p>What‚Äôs <code>hydraJob</code>?</p>
<blockquote>
<div class=highlight><pre tabindex=0 class=chroma><code class=language-nix data-lang=nix><span class=cm>/* Strip a derivation of all non-essential attributes, returning
</span><span class=cm>   only those needed by hydra-eval-jobs. Also strictly evaluate the
</span><span class=cm>   result to ensure that there are no thunks kept alive to prevent
</span><span class=cm>   garbage collection. */</span>
</code></pre></div></blockquote>
<p>Huh. I don‚Äôt know what <code>hydra-eval-jobs</code> is. I hope to find out more.</p>
<p>What are scopes? On <code>makeScope</code>:</p>
<blockquote>
<div class=highlight><pre tabindex=0 class=chroma><code class=language-nix data-lang=nix><span class=cm>/* Make a set of packages with a common scope. All packages called
</span><span class=cm>   with the provided `callPackage' will be evaluated with the same
</span><span class=cm>   arguments. Any package in the set may depend on any other. The
</span><span class=cm>   `overrideScope'` function allows subsequent modification of the package
</span><span class=cm>   set in a consistent way, i.e. all packages in the set will be
</span><span class=cm>   called with the overridden packages. The package sets may be
</span><span class=cm>   hierarchical: the packages in the set are called with the scope
</span><span class=cm>   provided by `newScope' and the set provides a `newScope' attribute
</span><span class=cm>   which can form the parent scope for later package sets. */</span>
</code></pre></div></blockquote>
<p>So this is like‚Ä¶ a way to group packages that have common dependencies, that all need to share the same dependencies? I think I need to see a concrete example of this.</p>
<p>I see it used in such files as <code>php-packages.nix</code>, <code>emacs-packages.nix</code>, <code>ocaml-packages.nix</code>, etc, as well as files like <code>gnome-3/default.nix</code> and <code>kde/default.nix</code>. And <code>qt</code> stuff‚Ä¶ so like basically what you‚Äôd expect. Packages that exist in a particular ‚Äúecosystem.‚Äù</p>
<p><code>makeScopeWithSplicing</code> has this to say for itself:</p>
<blockquote>
<div class=highlight><pre tabindex=0 class=chroma><code class=language-nix data-lang=nix><span class=cm>/* Like [makeScope], but aims to support cross compilation. It's still ugly, 
</span><span class=cm>   but hopefully it helps a little bit. */</span>
</code></pre></div></blockquote>
<p>A humble comment.</p>
<p>Man, we still have a lot to get through.</p>
<pre tabindex=0><code>nix-repl&gt; :p lib.fetchers
{ proxyImpureEnvVars = [ "http_proxy" "https_proxy" "ftp_proxy" "all_proxy" "no_proxy" ]; }
</code></pre><p>That one was easy. I assume this is a top-level thing like this so that it can be easily modified in an overlay or whatever.</p>
<pre tabindex=0><code>nix-repl&gt; :p lib.filesystem
{
  haskellPathsInDir = ¬´lambda @ .../nixpkgs/lib/filesystem.nix:6:23¬ª;
  listFilesRecursive = ¬´lambda @ .../nixpkgs/lib/filesystem.nix:50:24¬ª;
  locateDominatingFile = ¬´lambda @ .../nixpkgs/lib/filesystem.nix:28:26¬ª; 
}
</code></pre><p>Well that‚Äôs a little weird.</p>
<div class=highlight><pre tabindex=0 class=chroma><code class=language-nix data-lang=nix><span class=c1># haskellPathsInDir : Path -&gt; Map String Path</span>
<span class=c1># A map of all haskell packages defined in the given path,</span>
<span class=c1># identified by having a cabal file with the same name as the</span>
<span class=c1># directory itself.</span>

<span class=c1># locateDominatingFile :  RegExp</span>
<span class=c1>#                      -&gt; Path</span>
<span class=c1>#                      -&gt; Nullable { path : Path;</span>
<span class=c1>#                                    matches : [ MatchResults ];</span>
<span class=c1>#                                  }</span>
<span class=c1># Find the first directory containing a file matching 'pattern'</span>
<span class=c1># upward from a given 'file'.</span>
<span class=c1># Returns 'null' if no directories contain a file matching 'pattern'.</span>

<span class=c1># listFilesRecursive: Path -&gt; [ Path ]</span>
<span class=c1>#</span>
<span class=c1># Given a directory, return a flattened list of all files within it recursively.</span>
</code></pre></div><p>Weird. <code>haskellPathsInDir</code> is used in exactly one place: <code>pkgs/build-support/emacs/buffer.nix</code>:</p>
<div class=highlight><pre tabindex=0 class=chroma><code class=language-nix data-lang=nix><span class=c1># nix-buffer function for a project with a bunch of haskell packages</span>
<span class=c1># in one directory</span>
<span class=n>haskellMonoRepo</span> <span class=err>=</span> <span class=p>{</span> <span class=o>...</span> <span class=p>}:</span>
</code></pre></div><p>Shrug emoticon.</p>
<p><code>locateDominatingFile</code> is used in exactly zero places. And <code>listFilesRecursive</code> is‚Ä¶ also used in exactly zero places. Huh.</p>
<p>What‚Äôs the policy for deprecating or removing dead code? Like presumably people <em>could</em> be depending on these functions, in their own private package repositories. But surely‚Ä¶ surely Nixpkgs <em>does</em> remove dead code? Sometimes? It‚Äôs not an append-only thing?</p>
<p>I don‚Äôt know.</p>
<pre tabindex=0><code>nix-repl&gt; :p lib.fixedPoints
{
  composeExtensions = ¬´lambda @ .../nixpkgs/lib/fixed-points.nix:75:5¬ª;
  composeManyExtensions = ¬´lambda @ .../nixpkgs/lib/lists.nix:52:20¬ª;
  converge = ¬´lambda @ .../nixpkgs/lib/fixed-points.nix:32:14¬ª;
  extends = ¬´lambda @ .../nixpkgs/lib/fixed-points.nix:69:13¬ª;
  fix = ¬´lambda @ .../nixpkgs/lib/fixed-points.nix:19:9¬ª;
  fix' = ¬´lambda @ .../nixpkgs/lib/fixed-points.nix:25:10¬ª;
  makeExtensible = ¬´lambda @ .../nixpkgs/lib/fixed-points.nix:109:48¬ª;
  makeExtensibleWithCustomName = ¬´lambda @ .../nixpkgs/lib/fixed-points.nix:109:34¬ª;
}
</code></pre><p>The implementation of <code>fix</code> matches that of Haskell:</p>
<div class=highlight><pre tabindex=0 class=chroma><code class=language-nix data-lang=nix><span class=n>fix</span> <span class=err>=</span> <span class=n>f</span><span class=p>:</span> <span class=k>let</span> <span class=n>x</span> <span class=o>=</span> <span class=n>f</span> <span class=n>x</span><span class=p>;</span> <span class=k>in</span> <span class=n>x</span><span class=p>;</span>
</code></pre></div><p>So if I‚Äôm following correctly, this won‚Äôt ‚Äúrecurse‚Äù until a fixed-point is reached; this just calls the function with the output of itself, which will resolve any self-references to the argument.</p>
<p>But uhh how does that work if the argument is a plain old value? I haven‚Äôt really thought about this. I have never actually used <code>fix</code>, just been vaguely mystified by it in the past.</p>
<p>To dig in a little bit, I try to write:</p>
<pre tabindex=0><code>nix-repl&gt; lib.fixedPoints.fix (x: if x % 2 == 0 then x / 2 else x + 1)
error: syntax error, unexpected $undefined, expecting THEN, at (string):1:30
</code></pre><p>But that does not work with a <em>very</em> mysterious error message. Is‚Ä¶ is <code>%</code> not defined?</p>
<pre tabindex=0><code>nix-repl&gt; 1 % 2
error: syntax error, unexpected $undefined, expecting $end, at (string):1:3
</code></pre><p>Huh. Okay. Fine.</p>
<pre tabindex=0><code>nix-repl&gt; builtins.mod
error: attribute 'mod' missing, at (string):1:1

nix-repl&gt; builtins.modulo
error: attribute 'modulo' missing, at (string):1:1
</code></pre><p>Ugh okay I have to pull up the documentation to find that it‚Äôs <code>lib.trivial.mod</code>:</p>
<pre tabindex=0><code>nix-repl&gt; lib.fixedPoints.fix (x: if lib.trivial.mod x 2 == 0 then x / 2 else x + 1)
error: infinite recursion encountered, at /nix/store/mi0xpwzl81c7dgpr09qd67knbc24xab5-nixpkgs-21.05pre274251.f5f6dc053b1/nixpkgs/lib/trivial.nix:225:20
</code></pre><p>Okay. I take a step back and think about this. It makes sense; I was not reading this correctly at all.</p>
<p>I was thinking of the function Nix calls <code>converge</code>: gimme a function, gimme an input, apply until it returns a value. That‚Äôs what I was trying to write.</p>
<p>But that‚Äôs not <code>fix</code>. <code>fix</code> actually pulls a value out of a function <em>from nothing</em>. There is no ‚Äúseed‚Äù that it‚Äôs starting with.</p>
<p>So how can it call the function in the first place?</p>
<p>Well, because laziness: it can call the function with like‚Ä¶ a ‚Äúplaceholder,‚Äù sort of ‚Äì a thunk. And that value will not actually be evaluated until you ask for it. So you just can‚Äôt ask for it until the function itself has returned: you have to ensure that the argument is not evaluated eagerly. I think, anyway. Who knows if I‚Äôm getting this right. So I think I <em>can</em> say:</p>
<pre tabindex=0><code>nix-repl&gt; lib.fixedPoints.fix (x: [ x ])
[ [ ... ] ]
</code></pre><p>And that‚Äôs just fine. It‚Äôs the list that contains itself. <code>nix repl</code> is even smart enough to let me print this ‚Äúinfinite‚Äù value without blowing up my screen.</p>
<pre tabindex=0><code>nix-repl&gt; :p lib.fixedPoints.fix (x: [ x ])
[ [ ¬´repeated¬ª ] ]
</code></pre><p>Cool.</p>
<p>But I <em>can‚Äôt</em> say:</p>
<pre tabindex=0><code>nix-repl&gt; lib.fixedPoints.fix (x: x)
error: infinite recursion encountered, at (string):1:25
</code></pre><p>Because the function I passed to <code>fix</code> tries to evaluate its argument before it returns.</p>
<p>Or, no; that‚Äôs not quite right: the function doesn‚Äôt try to evaluate its argument; <code>nix repl</code> tries to evaluate it. All the evaluation is ‚Äúpull-based.‚Äù And when <code>nix repl</code> tries to pull the value out, it finds an infinite loop.</p>
<pre tabindex=0><code>nix-repl&gt; infiniteValue = lib.fixedPoints.fix (x: x)

nix-repl&gt; infiniteValue
error: infinite recursion encountered, at (string):1:26
</code></pre><p>But similarly, I‚Äôm sure I can‚Äôt say:</p>
<pre tabindex=0><code>nix-repl&gt; lib.fixedPoints.fix (x: builtins.seq x [ x ])
error: infinite recursion encountered, at undefined position
</code></pre><p>It‚Äôs pretty nice that Nix can detect this instead of just hanging! Thanks, Nix.</p>
<p>Okay; this makes sense to me. Does this make sense to <em>you?</em> I feel like this is maybe weird. I wish the Nix manual had spent some time more talking about laziness. I feel like most people are probably not coming to Nix with much experience with this concept.</p>
<p>Anyway, moving past <code>fix</code>: there‚Äôs something called <code>fix'</code> that I don‚Äôt really understand.</p>
<div class=highlight><pre tabindex=0 class=chroma><code class=language-nix data-lang=nix><span class=c1># A variant of `fix` that records the original recursive attribute set in the</span>
<span class=c1># result. This is useful in combination with the `extends` function to</span>
<span class=c1># implement deep overriding. See pkgs/development/haskell-modules/default.nix</span>
<span class=c1># for a concrete example.</span>
<span class=n>fix'</span> <span class=err>=</span> <span class=n>f</span><span class=p>:</span> <span class=k>let</span> <span class=n>x</span> <span class=o>=</span> <span class=n>f</span> <span class=n>x</span> <span class=o>//</span> <span class=p>{</span> <span class=n>__unfix__</span> <span class=o>=</span> <span class=n>f</span><span class=p>;</span> <span class=p>};</span> <span class=k>in</span> <span class=n>x</span><span class=p>;</span>
</code></pre></div><p>I do not think my brain can handle the concrete example, so I do no such thing, but make a note so that maybe I will come back to this later.</p>
<p>We see <code>extends</code>, as previously mentioned, which appears to be the machinery that ‚Äúoverlays‚Äù are implemented in terms of ‚Äì a similar ‚Äú<code>self: super:</code>‚Äù interface.</p>
<p><code>composeExtensions</code> composes functions of the <code>self: super:</code> shape. <code>makeExtensible</code> just adds an <code>extend</code> function to a set, which is the correct partial application of <code>exend</code>.</p>
<p>Okay. Makes sense. Machinery for overriding, basically.</p>
<pre tabindex=0><code>nix-repl&gt; :p lib.kernel
{
  freeform = ¬´lambda @ .../nixpkgs/lib/kernel.nix:14:14¬ª;
  module = {
    optional = false;
    tristate = "m";
  };
  no = {
    optional = false;
    tristate = "n";
  };
  option = ¬´lambda @ .../nixpkgs/lib/kernel.nix:8:12¬ª;
  whenHelpers = ¬´lambda @ .../nixpkgs/lib/kernel.nix:19:17¬ª;
  yes = {
    optional = false;
    tristate = "y";
  };
}
</code></pre><p>Your guess is as good as mine.</p>
<p>The first comment in <code>kernel.nix</code> is:</p>
<pre tabindex=0><code># Keeping these around in case we decide to change this horrible implementation :)
</code></pre><p>And <code>whenHelpers</code> is described as:</p>
<pre tabindex=0><code>/*
  Common patterns/legacy used in common-config/hardened/config.nix
 */
</code></pre><p>???</p>
<p>Look at uses, it seems like this is actually used for configuring the Linux kernel? Interesting. Sort of feels like <code>lib</code> is this giant monolithic catch-all instead of individual things having their own helpers. At least in some cases. I‚Äôm sure that‚Äôs not a fair generalization to make, considering that I am only looking at <code>lib</code>.</p>
<pre tabindex=0><code>nix-repl&gt; :p lib.meta
{
  addMetaAttrs = ¬´lambda @ .../nixpkgs/lib/meta.nix:15:18¬ª;
  appendToName = ¬´lambda @ .../nixpkgs/lib/meta.nix:40:18¬ª;
  dontDistribute = ¬´lambda @ .../nixpkgs/lib/meta.nix:21:20¬ª;
  hiPrio = ¬´lambda @ .../nixpkgs/lib/meta.nix:15:28¬ª;
  hiPrioSet = ¬´lambda @ .../nixpkgs/lib/meta.nix:69:15¬ª;
  lowPrio = ¬´lambda @ .../nixpkgs/lib/meta.nix:15:28¬ª;
  lowPrioSet = ¬´lambda @ .../nixpkgs/lib/meta.nix:59:16¬ª;
  mapDerivationAttrset = ¬´lambda @ .../nixpkgs/lib/meta.nix:46:26¬ª;
  platformMatch = ¬´lambda @ .../nixpkgs/lib/meta.nix:84:19¬ª;
  setName = ¬´lambda @ .../nixpkgs/lib/meta.nix:27:13¬ª;
  setPrio = ¬´lambda @ .../nixpkgs/lib/meta.nix:50:13¬ª;
  updateName = ¬´lambda @ .../nixpkgs/lib/meta.nix:35:16¬ª;
}
</code></pre><p>Okay; I <em>assume</em> these all do the trivial things, calling, like, <code>derivation.overrideAttrs</code> the way I‚Äôd expect.</p>
<p>No! In fact, looking at the source:</p>
<div class=highlight><pre tabindex=0 class=chroma><code class=language-nix data-lang=nix><span class=n>addMetaAttrs</span> <span class=err>=</span> <span class=n>newAttrs</span><span class=p>:</span> <span class=n>drv</span><span class=p>:</span>
  <span class=n>drv</span> <span class=o>//</span> <span class=p>{</span> <span class=n>meta</span> <span class=o>=</span> <span class=p>(</span><span class=n>drv</span><span class=o>.</span><span class=n>meta</span> <span class=n>or</span> <span class=p>{})</span> <span class=o>//</span> <span class=n>newAttrs</span><span class=p>;</span> <span class=p>};</span>
</code></pre></div><p>They‚Äôre just doing the even-more-trivial thing. Modifying it as a set. Huh! So there‚Äôd be a disagreement between, like, <code>derivation.meta</code> and <code>derivation.drvAttrs.meta</code>. Which I guess never matters? Hopefully?</p>
<p>Okay the next one is pretty fun.</p>
<p>We have <code>lib.misc</code>, and it contains a <em>bunch</em> of stuff, and I‚Äôm not going to talk about all the stuff.</p>
<p>I assumed this would be a <em>different</em> set of ‚Äúmiscellaneous functions‚Äù than the ‚Äúmiscellaneous functions‚Äù in <code>lib.trivial</code>. But it‚Äôs not. <code>lib.misc</code> contains all the functions defined in <code>lib/deprecated.nix</code>. Which really makes me <em>think</em> that it‚Äôs all the deprecated functions. But it‚Äôs not called <code>lib.deprecated</code>: that would be crazy. It‚Äôs called <code>misc</code>. Oooookay. I‚Äôm not going to dig into those because I am assuming they‚Äôre all deprecated.</p>
<p>Lastly we have <code>lib.modules</code>, which is <em>massive</em>.</p>
<p>There is no real description or high-level summary in <code>modules.nix</code> of what these functions are or what they do, but I <em>think</em> that I‚Äôm gathering from various comments hidden deep in the file that this is a NixOS thing?</p>
<p>I google ‚Äúnixos modules‚Äù and get <a href=https://nixos.wiki/wiki/Module>a hit on the wiki</a>:</p>
<blockquote>
<p>Modules are files combined by NixOS to produce the full system configuration. A module contains a Nix expression. It declares options for other modules to define (give a value). It processes them and defines options declared in other modules.</p>
</blockquote>
<p><code>lib.modules</code> seems to contain the machinery for doing that. So I‚Äôm just going to skip all of that.</p>
<p>And we‚Äôre done! We read Chapter 5; we did all the extra credit. Next time it looks like we‚Äôll get to learn about <code>stdenv</code>. I‚Äôm excited.</p>
<hr>
<ul>
<li>Why is <code>prefer-remote-fetch</code> kebab-cased?</li>
<li>Is it safe to get rid of <code>locateDominatingFile</code> (and other unused <code>lib</code> functions)?</li>
<li>What‚Äôs with <code>fix'</code> and the <code>__unfix__</code> attribute? Should I care about this?</li>
<li>What is <code>hydra-eval-jobs</code>?</li>
<li>Where is <code>lib.warn</code> defined?</li>
<li>Why is <code>lib.misc</code> not called <code>lib.deprecated</code>?</li>
<li>Why is <code>lib.trivial</code> not called <code>lib.misc</code>?</li>
</ul></div>
</article>
<div class=post-footer>
<a href="mailto:ianthehenry@gmail.com?subject=let%27s%20talk%20about%20%22Even%20more%20functions%2c%20somehow%22&amp;body=First%20of%20all,%20I%20just%20wanted%20to%20say%20that%20I%20forgive%20you%20for%20not%20having%20a%20real%20comment%20system%20on%20your%20site.">comment on this post</a><a href=https://ianthehenry.com/posts/how-to-learn-nix/the-standard-environment/>Next up ‚ûú The standard environment</a></div>
<aside class=series-rider>
<p>
This post is part of the series <a class=series-name href=https://ianthehenry.com/posts/how-to-learn-nix/>How to Learn Nix</a>.
You can
<a target=_blank href=https://ianthehenry.com/feed.xml>subscribe to my RSS feed</a>
or
<a target=_blank href=https://twitter.com/ianthehenry>follow me on Twitter</a>
for more, or <a href=https://ianthehenry.com/posts/>peruse my back catalog</a> if you're in the mood for something different.
<div class=subsection-header>Opening remarks</div><ol start=1 class=post-list><li><a href=https://ianthehenry.com/posts/how-to-learn-nix/introduction/>What's all this about?</a></li>
<li><a href=https://ianthehenry.com/posts/how-to-learn-nix/prior-knowledge/>Prior knowledge</a></li>
</ol><div class=subsection-header>Reading the Nix manual</div><ol start=3 class=post-list><li><a href=https://ianthehenry.com/posts/how-to-learn-nix/glossary/>What we talk about when we talk about Nix</a></li>
<li><a href=https://ianthehenry.com/posts/how-to-learn-nix/quick-start-guide/>Quick starts, full hearts</a></li>
<li><a href=https://ianthehenry.com/posts/how-to-learn-nix/basic-package-management/>Basic package management</a></li>
<li><a href=https://ianthehenry.com/posts/how-to-learn-nix/profiles/>Profiles</a></li>
<li><a href=https://ianthehenry.com/posts/how-to-learn-nix/garbage-collection/>Garbage collection</a></li>
<li><a href=https://ianthehenry.com/posts/how-to-learn-nix/channels/>Channels</a></li>
<li><a href=https://ianthehenry.com/posts/how-to-learn-nix/sharing/>Learning to share</a></li>
<li><a href=https://ianthehenry.com/posts/how-to-learn-nix/my-first-derivation/>My first derivation</a></li>
<li><a href=https://ianthehenry.com/posts/how-to-learn-nix/okay-my-actual-first-derivation/>Okay my actual first derivation</a></li>
<li><a href=https://ianthehenry.com/posts/how-to-learn-nix/nix-language/>The Nix expression language</a></li>
<li><a href=https://ianthehenry.com/posts/how-to-learn-nix/derivations/>Derivations</a></li>
<li><a href=https://ianthehenry.com/posts/how-to-learn-nix/built-in-functions/>Built-in Functions</a></li>
<li><a href=https://ianthehenry.com/posts/how-to-learn-nix/advanced-topics/>Advanced Topics</a></li>
<li><a href=https://ianthehenry.com/posts/how-to-learn-nix/command-reference/>Command Reference</a></li>
<li><a href=https://ianthehenry.com/posts/how-to-learn-nix/configuration/>Configuration</a></li>
</ol><div class=subsection-header>Interlude: in which we follow our hearts, however briefly</div><ol start=18 class=post-list><li><a href=https://ianthehenry.com/posts/how-to-learn-nix/nix-manual-reflection/>So I read the manual huh</a></li>
<li><a href=https://ianthehenry.com/posts/how-to-learn-nix/switching-from-homebrew-to-nix/>Switching from Homebrew to Nix</a></li>
<li><a href=https://ianthehenry.com/posts/how-to-learn-nix/my-first-nix-bug/>My first Nix bug</a></li>
<li><a href=https://ianthehenry.com/posts/how-to-learn-nix/my-first-package-upgrade/>My first package upgrade</a></li>
<li><a href=https://ianthehenry.com/posts/how-to-learn-nix/declarative-user-environment/>Setting up a declarative user environment</a></li>
</ol><div class=subsection-header>Reading the Nixpkgs manual</div><ol start=23 class=post-list><li><a href=https://ianthehenry.com/posts/how-to-learn-nix/how-to-learn-nixpkgs/>How to learn Nixpkgs</a></li>
<li><a href=https://ianthehenry.com/posts/how-to-learn-nix/overlays/>Overlays</a></li>
<li><a href=https://ianthehenry.com/posts/how-to-learn-nix/overriding/>Overriding</a></li>
<li><a href=https://ianthehenry.com/posts/how-to-learn-nix/an-infinite-list-of-functions/>An infinite list of functions</a></li>
<li><strong><a href=https://ianthehenry.com/posts/how-to-learn-nix/even-more-functions-somehow/>Even more functions, somehow</a></strong>&nbsp;‚Üê&nbsp;you are here</li>
<li><a href=https://ianthehenry.com/posts/how-to-learn-nix/the-standard-environment/>The standard environment</a></li>
<li><a href=https://ianthehenry.com/posts/how-to-learn-nix/derivations-in-detail/>Derivations in detail</a></li>
<li><a href=https://ianthehenry.com/posts/how-to-learn-nix/cross-compilation/>Cross-compilation</a></li>
<li><a href=https://ianthehenry.com/posts/how-to-learn-nix/platform-notes/>Platform notes</a></li>
<li><a href=https://ianthehenry.com/posts/how-to-learn-nix/builders/>Builders</a></li>
<li><a href=https://ianthehenry.com/posts/how-to-learn-nix/languages-and-frameworks/>Languages and frameworks</a></li>
<li><a href=https://ianthehenry.com/posts/how-to-learn-nix/random-package-grab-bag/>Random package grab-bag</a></li>
<li><a href=https://ianthehenry.com/posts/how-to-learn-nix/how-to-give-back/>How to give back</a></li>
</ol><div class=subsection-header>Documentation behind us, we set out on our own</div><ol start=36 class=post-list><li><a href=https://ianthehenry.com/posts/how-to-learn-nix/nixpkgs-reflection/>So I read the other manual, huh</a></li>
<li><a href=https://ianthehenry.com/posts/how-to-learn-nix/saving-your-shell/>Saving your shell</a></li>
</ol><div class=subsection-header>Oh right forgot about Nix Pills</div><ol start=38 class=post-list><li><a href=https://ianthehenry.com/posts/how-to-learn-nix/nix-pills/>Nix Pills</a></li>
</ol><div class=subsection-header>Our whole lives ahead of us</div><ol start=39 class=post-list><li><a href=https://ianthehenry.com/posts/how-to-learn-nix/python3-alpha/>How to install Python</a></li>
<li><a href=https://ianthehenry.com/posts/how-to-learn-nix/open-questions/>Open questions</a></li>
<li><a href=https://ianthehenry.com/posts/how-to-learn-nix/ambiguous-packages/>Ambiguous packages</a></li>
<li><a href=https://ianthehenry.com/posts/how-to-learn-nix/nix-zshell/>Running zsh in nix-shell</a></li>
</ol><div class=subsection-header>Nix 2.4 slithers to life</div><ol start=43 class=post-list><li><a href=https://ianthehenry.com/posts/how-to-learn-nix/flakes/>My first brush with flakes</a></li>
<li><a href=https://ianthehenry.com/posts/how-to-learn-nix/more-flakes/>More flakes, unfortunately</a></li>
<li><a href=https://ianthehenry.com/posts/how-to-learn-nix/new-profiles/>Fancy new profiles</a></li>
<li><a href=https://ianthehenry.com/posts/how-to-learn-nix/chipping-away-at-flakes/>Chipping away at flakes</a></li>
<li><a href=https://ianthehenry.com/posts/how-to-learn-nix/nix-develop/>New and unimproved shells</a></li>
</ol>
</aside>
</main>
<footer>
¬© 1899-1907 <a href=https://ianthehenry.com/about/>Ian Henry</a>
</footer>
